function LoadScreen(a,b){"use strict";function c(){K=requestAnimationFrame(c);for(k in H){var a=H[k],b=(a.targetValue-a.initialValue)/G/60;a.value=a.targetValue>=a.initialValue?Math.min(a.targetValue,a.value+b):Math.max(a.targetValue,a.value+b),"function"==typeof a.onUpdate&&a.onUpdate(),a.value===a.targetValue&&("function"==typeof a.onComplete&&a.onComplete(),"progress"===k&&1===a.value&&(delete H.progress,cancelAnimationFrame(K)))}}function d(a){C&&console.timeEnd("Total load screen duration"),A.domElement.parentNode.removeChild(A.domElement),F=!0,a&&"function"==typeof a&&a()}function e(a,b){F||(A.domElement.style.marginTop="-"+b/devicePixelRatio+"px",A.domElement.style.height=b/devicePixelRatio+"px",A.domElement.style.width=a/devicePixelRatio+"px")}function f(){var a=A.resources;if(a.textures){X.textures={};for(var b in a.textures){var c=a.textures[b];c.path&&c.fileSize&&(X.textures[b]={},c.GPUCompression&&(c.GPUCompression.PVR&&p("PVR")?(c.path=c.GPUCompression.PVR.path,c.fileSize=c.GPUCompression.PVR.fileSize):c.GPUCompression.KTX&&p("KTX")&&(c.path=c.GPUCompression.KTX.path,c.fileSize=c.GPUCompression.KTX.fileSize)),$[b]={prog:0,fileSize:c.fileSize},da+=c.fileSize,N++)}}if(a.cubeTextures){X.cubeTextures={};for(var b in a.cubeTextures){var c=a.cubeTextures[b];c.paths&&c.filesSize&&(X.cubeTextures[b]={},_[b]={prog:0,fileSize:c.filesSize},ea+=c.filesSize,N++)}}if(a.fonts){X.fonts={};for(var b in a.fonts){var d=a.fonts[b];d.path&&d.fileSize&&(X.fonts[b]={},aa[b]={prog:0,fileSize:d.fileSize},fa+=d.filesSize,N++)}}if(a.geometries){X.geometries={};for(var b in a.geometries)a.geometries[b].path&&a.geometries[b].fileSize&&(X.geometries[b]={},ba[b]={prog:0,fileSize:a.geometries[b].fileSize},ha+=a.geometries[b].fileSize,N++)}if(a.objects){X.objects={};for(var b in a.objects)a.objects[b].path&&a.objects[b].fileSize&&(X.objects[b]={},ca[b]={prog:0,fileSize:a.objects[b].fileSize},ia+=a.objects[b].fileSize,N++)}if(a.textures)for(var b in a.textures)a.textures[b].path&&a.textures[b].fileSize&&h(b);if(a.cubeTextures)for(var b in a.cubeTextures)a.cubeTextures[b].paths&&a.cubeTextures[b].filesSize&&j(b);if(a.fonts)for(var b in a.fonts)a.fonts[b].path&&a.fonts[b].fileSize&&i(b);if(a.geometries)for(var b in a.geometries)a.geometries[b].path&&a.geometries[b].fileSize&&g(b);if(a.objects)for(var b in a.objects)a.objects[b].path&&a.objects[b].fileSize&&l(b)}function g(a){var b=A.resources.geometries[a],c=b.path.split("."),d=c[c.length-1];q(d).load(b.path,function(b){X.geometries[a]=b,ba[a].prog=1,M++,w({type:"Geometry",name:a,progress:1}),x(!0)},function(b){var c=b.loaded/b.total;ba[a].prog=c,1!==c&&w({type:"Geometry",name:a,progress:c}),x()})}function h(a){var b=A.resources.textures[a],c=b.path.split("."),d=c[c.length-1];n(d).load(b.path,function(b){X.textures[a]=b,$[a].prog=1,M++,w({type:"Texture",name:a,progress:1}),x(!0)},function(b){var c=b.loaded/b.total;$[a].prog=c,1!==c&&w({type:"Texture",name:a,progress:c}),x()})}function i(a){U.main=U.main||new THREE.TTFLoader,U.main.load(A.resources.fonts[a].path,function(b){X.fonts[a]=b,aa[a].prog=1,M++,w({type:"Font",name:a,progress:1}),x(!0)},function(b){var c=b.loaded/b.total;aa[a].prog=c,1!==c&&w({type:"Font",name:a,progress:c}),x()})}function j(a){var b=A.resources.cubeTextures[a],c=b.paths[0].split("."),d=c[c.length-1];o(d).load(b.paths,function(b){X.cubeTextures[a]=b,_[a].prog=1,M++,w({type:"Cube texture",name:a,progress:1}),x(!0)},function(b){var c=b.loaded/b.total;_[a].prog=c,1!==c&&w({type:"Cube texture",name:a,progress:c}),x()})}function l(a){var b=A.resources.objects[a],c=b.path.split("."),d=c.length,e="assimp"===c[d-2]?"assimpJSON":c[d-1],f=m(e),g=function(b,c){var d="assimp"===e?c:b;X.objects[a]=d,ca[a].prog=1,M++,w({type:"Object",name:a,progress:1}),x(!0)},h=function(b){var c=b.loaded/b.total;ca[a].prog=c,1!==c&&w({type:"Object",name:a,progress:c}),x()};switch(e){case"mmd":f.load(b.path,b.vmdPaths,g,h);break;case"dae":b.convertUpAxis&&(f.convertUpAxis=b.convertUpAxis);default:f.load(b.path,g,h)}}function m(a){switch(a){case"3mf":return W.threemf||(W.threemf=new THREE.ThreeMFLoader),W.threemf;case"amf":return W.amf||(W.amf=new THREE.AMFLoader),W.amf;case"assimp":return W.assimp||(W.assimp=new THREE.AssimpLoader),W.assimp;case"assimpJSON":return W.assimpJSON||(W.assimpJSON=new THREE.AssimpJSONLoader),W.assimpJSON;case"awd":return W.awd||(W.awd=new THREE.AWDLoader),W.awd;case"babylon":return W.babylon||(W.babylon=new THREE.BabylonLoader),W.babylon;case"dae":return W.dae||(W.dae=new THREE.ColladaLoader),W.dae;case"fbx":return W.fbx||(W.fbx=new THREE.FBXLoader),W.fbx;case"obj":return W.obj||(W.obj=new THREE.OBJLoader),W.obj;case"pcd":return W.pcd||(W.pcd=new THREE.PCDLoader),W.pcd;case"utf8":return W.utf8||(W.utf8=new THREE.UTF8Loader),W.utf8;case"wrl":case"wrz":case"vrml":return W.vrml||(W.vrml=new THREE.VRMLLoader),W.vrml}}function n(a){switch(a){case"tga":return S.tga=S.tga||new THREE.TGALoader,S.tga;case"pvr":return S.pvr=S.pvr||new THREE.PVRLoader,S.pvr;case"ktx":return S.ktx=S.ktx||new THREE.KTXLoader,S.ktx;default:return S.main=S.main||new THREE.TextureLoader,S.main}}function o(a){switch(a){case"hdr":return T.hdr=T.hdr||new THREE.HDRCubeTextureLoader,T.hdr;default:return T.main=T.main||new THREE.CubeTextureLoader,T.main}}function p(b){return"undefined"==typeof Z[b]&&(Y=Y||a.context.getSupportedExtensions(),"PVR"===b?Z[b]=Y.indexOf("WEBGL_compressed_texture_pvrtc")>-1||Y.indexOf("WEBKIT_WEBGL_compressed_texture_pvrtc")>-1:Z[b]=Y.indexOf("WEBGL_compressed_texture_etc1")>-1),Z[b]}function q(a){switch(a){case"ctm":return V.ctm=V.ctm||new THREE.CTMLoader,V.ctm;case"json":return V.json=V.json||new THREE.JSONLoader,V.json;case"ply":return V.ply=V.ply||new THREE.PLYLoader,V.ply;case"stl":return V.stl=V.stl||new THREE.STLLoader,V.stl;case"vtk":return V.vtk=V.vtk||new THREE.VTKLoader,V.vtk}}function r(){C&&console.time("Processing duration");var b=A.resources.textures,c=X.textures;if(b)for(var d in c){for(var e in b[d])"undefined"!=typeof c[d][e]&&(c[d][e]=b[d][e]);b[d]=c[d],b[d].name=d,delete c[d]}var f=A.resources.cubeTextures,g=X.cubeTextures;if(f)for(var d in g){if(f[d].toPMREM){var h=new THREE.PMREMGenerator(g[d]);h.update(a);var i=new THREE.PMREMCubeUVPacker(h.cubeLods);i.update(a),g[d]=i.CubeUVRenderTarget.texture}for(var e in f[d])"undefined"!=typeof g[d][e]&&(g[d][e]=f[d][e]);f[d]=g[d],f[d].name=d,delete g[d]}var j=A.resources.fonts,k=X.fonts;if(j)for(var d in k){k[d]=new THREE.Font(k[d]);for(var e in j[d])"undefined"!=typeof k[d][e]&&(k[d][e]=j[d][e]);j[d]=k[d],j[d].name=d,delete k[d]}var l=A.resources.geometries,m=X.geometries;if(l)for(var d in m)l[d].toBufferGeometry&&"BufferGeometry"!==m[d].type&&(m[d]=(new THREE.BufferGeometry).fromGeometry(m[d])),l[d].onComplete&&ga[d].onComplete(m[d]),l[d]=m[d],l[d].name=d,delete m[d];var n=A.resources.objects,o=X.objects;if(n){var p=function(a,c){for(var d in n[a])"type"!==d&&"undefined"!=typeof c[d]&&(d.indexOf("map")>-1||d.indexOf("Map")>-1?c[d]=b[n[a][d]]:c[d]=n[a][d],delete n[a][d])},q=function(a,b,c){var d;switch(n[a].type){case"mesh":d=new THREE.Mesh(v,w);break;case"points":d=new THREE.Points(v,w);break;case"line":d=new THREE.Line(v,w);break;default:d=new THREE.Mesh(v,w)}return delete n[a].type,d},r=function(a,b){for(var c in n[a])"undefined"!=typeof b[c]?b[c]=n[a][c]:b.userData[c]=n[a][c],delete n[a]};for(var d in n)if(n[d].path&&n[d].fileSize){var e=n[d].path,s=e.split("."),t=s.length,u;u="assimp"===s[t-2]?o[d].object:"dae"===s[t-1]?o[d].scene:o[d],p(d,u.material),r(d,u),n[d].onComplete&&n[d].onComplete(u),n[d]=u,n[d].name=d,delete o[d]}else if("string"==typeof n[d].geometry){var v=A.resources.geometries[n[d].geometry],w=n[d].material;delete n[d].geometry,delete n[d].material,p(d,w);var u=q(d,v,w);r(d,u),n[d].onComplete&&n[d].onComplete(u),n[d]=u,n[d].name=d}else if(!n[d]instanceof THREE.Object3D){var v=n[d].geometry,w=n[d].material;delete n[d].geometry,delete n[d].material,p(d,n[d].material);var u=q(d,v,w);r(d,u),n[d].onComplete&&n[d].onComplete(u),n[d]=u,n[d].name=d}}C&&console.timeEnd("Processing duration")}function s(){var c=document.createElement("div"),d=document.createElement("div");c.style.cssText="background: "+b.background+";position: relative;overflow: hidden;";var e=b.size.indexOf("%")>-1?"%":"px",f=parseInt(b.size)/2+e;d.style.cssText="width: "+b.size+";top: 50%; left: 50%;margin-left: -"+f+";text-align: center;position: relative;display: inline-block",A.domElement=c,A.infoContainer=d,A.setSize(a.domElement.width,a.domElement.height),a.domElement.parentNode.appendChild(c)}function t(){switch(b.textInfo&&(O=document.createElement("p"),O.textContent="string"==typeof b.textInfo?b.textInfo:b.textInfo[0],O.style.cssText="color: "+b.infoColor+";display: inline-block;font-family: monospace;font-size: 12px"),b.sizeInfo&&(P=document.createElement("p"),P.textContent="0.00MB",P.style.cssText="color: "+b.infoColor+";font-family: monospace;font-size: 12px;display: inline-block;"),b.type){case"bar":u();break;case"circular":v();break;default:u()}}function u(){var a=document.createElement("div"),c=document.createElement("div");a.style.cssText="background: "+b.progressBarContainer+";border: solid 1px "+b.progressBarContainer+";width: 100%; height: "+b.weight+";box-sizing: border-box;position: relative;",c.style.cssText="background: "+b.progressBar+";width: 0%; height: 100%;top: 0; left: 0;position: absolute;",a.appendChild(c),b.textInfo&&A.infoContainer.appendChild(O),A.infoContainer.appendChild(a),b.sizeInfo&&A.infoContainer.appendChild(P);var d=function(){c.style.width=(100*H.progress.value).toString()+"%",b.sizeInfo&&(P.textContent=(H.progress.value*(da+ha)/1024).toFixed(2)+" MB")};H.progress={key:"progress",duration:G,targetValue:E,initialValue:0,value:0,onUpdate:d},I.push(function(){H.progress.initialValue=H.progress.value,H.progress.targetValue=E,H.progress.duration+=G})}function v(){var a="<svg style='width: 100%; height: 100%;' width=200 height=200 viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>\t<circle fill="+b.progressBarContainer+" cx='0' cy='0' transform='translate(100,100)'  r='"+(80+parseInt(b.weight)/2+2).toString()+"'/>\t<circle fill="+b.background+" cx='0' cy='0' transform='translate(100,100)'  r='"+(80-parseInt(b.weight)/2-2).toString()+"'/>\t<circle fill='none' cx='0' cy='0' transform='translate(100,100) rotate(-90)' r='80' stroke-dashoffset='1503'/></svg>";A.infoContainer.innerHTML=a;var c=A.infoContainer.firstElementChild.lastElementChild;if(c.style.cssText="stroke:"+b.progressBar+";stroke-width:"+parseInt(b.weight)+";stroke-dasharray:502;",b.textInfo||b.sizeInfo){var d=document.createElement("div");d.style.cssText="width: 100%; left: 50%; top: 50%;margin-left: -50%;position: absolute;",A.infoContainer.appendChild(d),b.textInfo&&d.appendChild(O),b.sizeInfo&&d.appendChild(P),O.style.display=P.style.display="block"}var e=function(){c.setAttribute("stroke-dashoffset",(502*(1-H.progress.value)).toString()),b.sizeInfo&&(P.textContent=(H.progress.value*(da+ha)/1024).toFixed(2)+" MB")};H.progress={key:"progress",duration:G,targetValue:E,initialValue:0,value:0,onUpdate:e},I.push(function(){H.progress.initialValue=H.progress.value,H.progress.targetValue=E,H.progress.duration+=G})}function w(a){var b=0,c=0;for(var d in $)b+=$[d].prog*$[d].fileSize;for(var d in ba)c+=ba[d].prog*ba[d].fileSize;E=(b+c)/(da+ha),"undefined"!=typeof a&&C&&console.info("Progress = "+E+", "+a.type+" > "+a.name+" > "+Math.round(100*a.progress)+"%"),x()}function x(a){for(var c=0;c<I.length;c++)I[c](E);if(1===E&&a){C&&console.timeEnd("Loading duration");var d=function(){A.resources?"custom"!==b.type&&b.textInfo?(O.textContent="string"==typeof b.textInfo?b.textInfo:b.textInfo[1],setTimeout(function(){r(),O.textContent="string"==typeof b.textInfo?b.textInfo:b.textInfo[2],setTimeout(y,20)},20)):(r(),y()):z()};"custom"!==b.type?H.progress.onComplete=function(){1===H.progress.value&&d()}:d()}}function y(){var b=new THREE.Scene,c=new THREE.OrthographicCamera((-1),1,1,(-1),0,2),d=new THREE.WebGLRenderTarget(10,10,{generateMipmaps:!0});for(var e in A.resources.objects)b.add(A.resources.objects[e]);C&&console.time("Compiling duration"),a.render(b,c,d);for(var e in A.resources.objects)b.remove(A.resources.objects[e]);C&&console.timeEnd("Compiling duration"),d.dispose(),z()}function z(){"custom"!==b.type&&b.textInfo&&(O.textContent="string"==typeof b.textInfo?b.textInfo:b.textInfo[3],setTimeout(function(){C&&console.time("Scene creation duration");for(var a=0;a<J.length;a++)J[a]();C&&console.timeEnd("Scene creation duration")},20))}var A=this,B=null,C=!1,D=!1,E=0,F=!1,G=.5,H={},I=[],J=[],K,L,M=0,N=0,O,P,Q,R,S={},T={},U={},V={},W={},X={},Y,Z={},$={},_={},aa={},ba={},ca={},da=0,ea=0,fa=0,ha=0,ia=0;return this.domElement=null,this.infoContainer=null,this.resources=null,this.setSize=e,b=b||{},b={type:"undefined"!=typeof b.type?b.type:"bar",size:b.size?b.size:"150px",background:b.background?b.background:"#333",progressBarContainer:b.progressBarContainer?b.progressBarContainer:"#444",progressBar:b.progressBar?b.progressBar:"#fb0",weight:b.weight?b.weight:"6px",infoColor:b.infoColor?b.infoColor:"#666",sizeInfo:"undefined"==typeof b.sizeInfo||b.sizeInfo,textInfo:"undefined"!=typeof b.textInfo?b.textInfo:["Loading","Processing","Compiling","Creating scene"]},s(),"custom"!==b.type&&t(),this.start=function(a){if("custom"!==b){A.domElement.appendChild(A.infoContainer);var d=-parseInt(getComputedStyle(A.infoContainer,null).height)/2;if(A.infoContainer.style.marginTop=d+"px","circular"===b.type){var e=-parseInt(getComputedStyle(A.infoContainer.lastElementChild,null).height)/2;A.infoContainer.lastElementChild.style.marginTop=e+"px"}c()}return C&&console.time("Total load screen duration"),a&&(C&&console.time("Loading duration"),A.resources=a,f()),A},this.remove=function(a){"custom"!==b.type?(c(),H.disappear={key:"opacity",duration:G,targetValue:0,initialValue:1,value:1,onUpdate:function(){A.infoContainer.style.opacity=H.disappear.value},onComplete:function(){cancelAnimationFrame(K),d(a)}}):d(a)},this.setProgress=function(a){E=a,x(!0)},this.setOptions=function(a){return G="undefined"!=typeof a.tweenDuration?a.tweenDuration:G,D="undefined"!=typeof a.forcedStart?a.forcedStart:D,C="undefined"!=typeof a.verbose?a.verbose:C,A},this.onProgress=function(){for(var a=0;a<arguments.length;a++)arguments[a]&&"function"==typeof arguments[a]&&I.push(arguments[a]);return A},this.onComplete=function(){for(var a=0;a<arguments.length;a++)arguments[a]&&"function"==typeof arguments[a]&&J.push(arguments[a]);return A},this}