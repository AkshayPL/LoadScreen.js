function LoadScreen(a,b){"use strict";function c(){E=requestAnimationFrame(c);for(k in B){var a=B[k],b=(a.targetValue-a.initialValue)/A/60;a.value=a.targetValue>=a.initialValue?Math.min(a.targetValue,a.value+b):Math.max(a.targetValue,a.value+b),"function"==typeof a.onUpdate&&a.onUpdate(),a.value===a.targetValue&&("function"==typeof a.onComplete&&a.onComplete(),"progress"===k&&1===a.value&&(delete B.progress,cancelAnimationFrame(E)))}}function d(a){w&&console.timeEnd("Total load screen duration"),u.domElement.parentNode.removeChild(u.domElement),z=!0,a&&"function"==typeof a&&a()}function e(a,b){z||(u.domElement.style.marginTop="-"+b/devicePixelRatio+"px",u.domElement.style.height=b/devicePixelRatio+"px",u.domElement.style.width=a/devicePixelRatio+"px")}function f(){var a=u.resources;if(a.textures){I+=Object.keys(a.textures).length,N.textures={};for(var b in a.textures)N.textures[b]={},O[b]={prog:0,fileSize:a.textures[b].fileSize},Q+=a.textures[b].fileSize}if(a.geometries){I+=Object.keys(a.geometries).length,N.geometries={};for(var b in a.geometries)N.geometries[b]={},P[b]={prog:0,fileSize:a.geometries[b].fileSize},R+=a.geometries[b].fileSize}if(a.geometries)for(var b in a.geometries)g(b);if(a.textures)for(var b in a.textures)h(b)}function g(a){var b=u.resources.geometries[a],c=b.path.split("."),d=c[c.length-1];j(d).load(b.path,function(b){b.name=a,N.geometries[a]=b,P[a].prog=1,G++,q({geometry:!0,name:a,progress:1}),r(!0)},function(b){var c=b.loaded/b.total;P[a].prog=c,1!==c&&q({geometry:!0,name:a,progress:c}),r()})}function h(a){var b=u.resources.textures[a],c=b.path.split("."),d=c[c.length-1];i(d).load(b.path,function(c){for(var d in b)"fileSize"!==d&&"path"!==d&&"undefined"!=typeof c[d]&&(c[d]=b[d]);c.name=a,N.textures[a]=c,O[a].prog=1,G++,q({texture:!0,name:a,progress:1}),r(!0)},function(b){var c=b.loaded/b.total;O[a].prog=c,1!==c&&q({texture:!0,name:a,progress:c}),r()})}function i(a){switch(a){case"jpg":case"png":return M.main||(M.main=new THREE.TextureLoader),M.main}}function j(a){switch(a){case"json":return L.json=L.json||new THREE.JSONLoader,L.json;case"ply":return L.ply=L.ply||new THREE.PLYLoader,L.ply;case"stl":return L.stl=L.stl||new THREE.STLLoader,L.stl;case"ctm":return L.ctm=L.ctm||new THREE.CTMLoader,L.ctm;case"vtk":return L.vtk=L.vtk||new THREE.VTKLoader,L.vtk}}function l(){w&&console.time("Processing duration");var a=u.resources.textures,b=N.textures;if(a)for(var c in b){for(var d in a[c])"path"!==d&&"fileSize"!==d&&(b[c][d]=a[c][d]);a[c]=b[c],delete b[c]}var e=u.resources.geometries,f=N.geometries;if(e)for(var c in f)e[c].toBufferGeometry&&"BufferGeometry"!==f[c].type&&(f[c]=(new THREE.BufferGeometry).fromGeometry(f[c])),e[c].copyUv1ToUv2&&"BufferGeometry"===f[c].type&&f[c].addAttribute("uv2",f[c].attributes.uv),e[c].computeNormals&&f[c].computeVertexNormals(),e[c].computeFlatNormals&&f[c].computeFlatVertexNormals(),e[c]=f[c],delete f[c];var g=u.resources.objects;if(g)for(var c in g){var h=u.resources.geometries[g[c].geometry],i=g[c].material;delete g[c].geometry,delete g[c].material;for(var d in g[c])"type"!==d&&"undefined"!=typeof i[d]&&(d.indexOf("map")>-1||d.indexOf("Map")>-1?i[d]=a[g[c][d]]:i[d]=g[c][d],delete g[c][d]);var j;switch(g[c].type){case"mesh":j=new THREE.Mesh(h,i);break;case"points":j=new THREE.Points(h,i);break;case"line":j=new THREE.Line(h,i);break;default:j=new THREE.Mesh(h,i)}delete g[c].type;for(var d in g[c])console.log(d,c),"undefined"!=typeof j[d]?j[d]=g[c][d]:j.userData[d]=g[c][d],delete g[c];g[c]=j}w&&console.timeEnd("Processing duration")}function m(){var c=document.createElement("div"),d=document.createElement("div");c.style.cssText="background: "+b.background+";position: relative;overflow: hidden;";var e=b.size.indexOf("%")>-1?"%":"px",f=parseInt(b.size)/2+e;d.style.cssText="width: "+b.size+";top: 50%; left: 50%;margin-left: -"+f+";text-align: center;position: relative;display: inline-block",u.domElement=c,u.infoContainer=d,u.setSize(a.domElement.width,a.domElement.height),a.domElement.parentNode.appendChild(c)}function n(){switch(b.textInfo&&(J=document.createElement("p"),J.textContent="string"==typeof b.textInfo?b.textInfo:b.textInfo[0],J.style.cssText="color: "+b.infoColor+";display: inline-block;font-family: monospace;font-size: 12px"),b.sizeInfo&&(K=document.createElement("p"),K.textContent="0.00MB",K.style.cssText="color: "+b.infoColor+";font-family: monospace;font-size: 12px;display: inline-block;"),b.type){case"bar":o();break;case"circular":p();break;default:o()}}function o(){var a=document.createElement("div"),c=document.createElement("div");a.style.cssText="background: "+b.progressBarContainer+";border: solid 1px "+b.progressBarContainer+";width: 100%; height: "+b.weight+";box-sizing: border-box;position: relative;",c.style.cssText="background: "+b.progressBar+";width: 0%; height: 100%;top: 0; left: 0;position: absolute;",a.appendChild(c),b.textInfo&&u.infoContainer.appendChild(J),u.infoContainer.appendChild(a),b.sizeInfo&&u.infoContainer.appendChild(K);var d=function(){c.style.width=(100*B.progress.value).toString()+"%",b.sizeInfo&&(K.textContent=(B.progress.value*(Q+R)/1024).toFixed(2)+" MB")};B.progress={key:"progress",duration:A,targetValue:y,initialValue:0,value:0,onUpdate:d},C.push(function(){B.progress.initialValue=B.progress.value,B.progress.targetValue=y,B.progress.duration+=A})}function p(){var a="<svg style='width: 100%; height: 100%;' width=200 height=200 viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>\t<circle fill="+b.progressBarContainer+" cx='0' cy='0' transform='translate(100,100)'  r='"+(80+parseInt(b.weight)/2+2).toString()+"'/>\t<circle fill="+b.background+" cx='0' cy='0' transform='translate(100,100)'  r='"+(80-parseInt(b.weight)/2-2).toString()+"'/>\t<circle fill='none' cx='0' cy='0' transform='translate(100,100) rotate(-90)' r='80' stroke-dashoffset='1503'/></svg>";u.infoContainer.innerHTML=a;var c=u.infoContainer.firstElementChild.lastElementChild;if(c.style.cssText="stroke:"+b.progressBar+";stroke-width:"+parseInt(b.weight)+";stroke-dasharray:502;",b.textInfo||b.sizeInfo){var d=document.createElement("div");d.style.cssText="width: 100%; left: 50%; top: 50%;margin-left: -50%;position: absolute;",u.infoContainer.appendChild(d),b.textInfo&&d.appendChild(J),b.sizeInfo&&d.appendChild(K),J.style.display=K.style.display="block"}var e=function(){c.setAttribute("stroke-dashoffset",(502*(1-B.progress.value)).toString()),b.sizeInfo&&(K.textContent=(B.progress.value*(Q+R)/1024).toFixed(2)+" MB")};B.progress={key:"progress",duration:A,targetValue:y,initialValue:0,value:0,onUpdate:e},C.push(function(){B.progress.initialValue=B.progress.value,B.progress.targetValue=y,B.progress.duration+=A})}function q(a){var b=0,c=0;for(var d in O)b+=O[d].prog*O[d].fileSize;for(var d in P)c+=P[d].prog*P[d].fileSize;if(y=(b+c)/(Q+R),"undefined"!=typeof a&&w){var e=a.texture?"Texture":a.geometry?"Geometry":"Unknown asset type";console.info("Progress = "+y+", "+e+" > "+a.name+" > "+Math.round(100*a.progress)+"%")}r()}function r(a){for(var c=0;c<C.length;c++)C[c](y);if(1===y&&a){w&&console.timeEnd("Loading duration");var d=function(){u.resources?"custom"!==b.type&&b.textInfo?(J.textContent="string"==typeof b.textInfo?b.textInfo:b.textInfo[1],setTimeout(function(){l(),J.textContent="string"==typeof b.textInfo?b.textInfo:b.textInfo[2],setTimeout(s,20)},20)):(l(),s()):t()};"custom"!==b.type?B.progress.onComplete=function(){1===B.progress.value&&d()}:d()}}function s(){var b=new THREE.Scene,c=new THREE.OrthographicCamera((-1),1,1,(-1),0,2),d=new THREE.WebGLRenderTarget(10,10,{generateMipmaps:!0});for(var e in u.resources.objects)b.add(u.resources.objects[e]);w&&console.time("Compiling duration"),a.render(b,c,d);for(var e in u.resources.objects)b.remove(u.resources.objects[e]);w&&console.timeEnd("Compiling duration"),d.dispose(),t()}function t(){for(var a=0;a<D.length;a++)D[a]()}var u=this,v=null,w=!1,x=!1,y=0,z=!1,A=.5,B={},C=[],D=[],E,F,G=0,H=0,I=0,J,K,L={},M={},N={},O={},P={},Q=0,R=0;return this.domElement=null,this.infoContainer=null,this.resources=null,this.setSize=e,b=b||{},b={type:"undefined"!=typeof b.type?b.type:"bar",size:b.size?b.size:"150px",background:b.background?b.background:"#333",progressBarContainer:b.progressBarContainer?b.progressBarContainer:"#444",progressBar:b.progressBar?b.progressBar:"#fb0",weight:b.weight?b.weight:"6px",infoColor:b.infoColor?b.infoColor:"#666",sizeInfo:"undefined"==typeof b.sizeInfo||b.sizeInfo,textInfo:"undefined"!=typeof b.textInfo?b.textInfo:["Loading","Processing","Compiling"]},m(),"custom"!==b.type&&n(),this.start=function(a){if("custom"!==b){u.domElement.appendChild(u.infoContainer);var d=-parseInt(getComputedStyle(u.infoContainer,null).height)/2;if(u.infoContainer.style.marginTop=d+"px","circular"===b.type){var e=-parseInt(getComputedStyle(u.infoContainer.lastElementChild,null).height)/2;u.infoContainer.lastElementChild.style.marginTop=e+"px"}c()}return w&&console.time("Total load screen duration"),a&&(w&&console.time("Loading duration"),u.resources=a,f()),u},this.remove=function(a){"custom"!==b.type?(c(),B.disappear={key:"opacity",duration:A,targetValue:0,initialValue:1,value:1,onUpdate:function(){u.infoContainer.style.opacity=B.disappear.value},onComplete:function(){cancelAnimationFrame(E),d(a)}}):d(a)},this.setProgress=function(a){y=a,r(!0)},this.setOptions=function(a){return A="undefined"!=typeof a.tweenDuration?a.tweenDuration:A,x="undefined"!=typeof a.forcedStart?a.forcedStart:x,w="undefined"!=typeof a.verbose?a.verbose:w,u},this.onProgress=function(){for(var a=0;a<arguments.length;a++)arguments[a]&&"function"==typeof arguments[a]&&C.push(arguments[a]);return u},this.onComplete=function(){for(var a=0;a<arguments.length;a++)arguments[a]&&"function"==typeof arguments[a]&&D.push(arguments[a]);return u},this}