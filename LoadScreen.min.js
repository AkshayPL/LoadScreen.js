function LoadScreen(a,b){"use strict";function c(){N=requestAnimationFrame(c);for(k in K){var a=K[k],b=(a.targetValue-a.initialValue)/a.duration/60;a.value=a.targetValue>=a.initialValue?Math.min(a.targetValue,a.value+b):Math.max(a.targetValue,a.value+b),"function"==typeof a.onUpdate&&a.onUpdate(),a.value===a.targetValue&&("function"==typeof a.onComplete&&a.onComplete(),"progress"===k&&1===a.value&&(delete K.progress,cancelAnimationFrame(N)))}}function d(a){E&&console.timeEnd("Total load screen duration"),C.domElement.parentNode.removeChild(C.domElement),J=!0,a&&"function"==typeof a&&a()}function e(a,b){J||(C.domElement.style.marginTop="-"+b/devicePixelRatio+"px",C.domElement.style.height=b/devicePixelRatio+"px",C.domElement.style.width=a/devicePixelRatio+"px")}function f(){var a=C.resources;if(a.files){ba.files={};for(var b in a.files){var c=a.files[b];c.path&&c.fileSize&&(ba.files[b]={},ea[b]={prog:0,fileSize:d.fileSize},ma+=d.fileSize,Q++)}}if(a.fonts){ba.fonts={};for(var b in a.fonts){var c=a.fonts[b];c.path&&c.fileSize&&(ba.fonts[b]={},fa[b]={prog:0,fileSize:c.fileSize},na+=c.filesSize,Q++)}}if(a.textures){ba.textures={};for(var b in a.textures){var d=a.textures[b];d.path&&d.fileSize&&(ba.textures[b]={},d.GPUCompression&&(d.GPUCompression.PVR&&s("PVR")?(d.path=d.GPUCompression.PVR.path,d.fileSize=d.GPUCompression.PVR.fileSize):d.GPUCompression.KTX&&s("KTX")&&(d.path=d.GPUCompression.KTX.path,d.fileSize=d.GPUCompression.KTX.fileSize)),ha[b]={prog:0,fileSize:d.fileSize},oa+=d.fileSize,Q++)}}if(a.materials){ba.materials={};for(var b in a.materials){var d=a.materials[b];d.path&&d.fileSize&&(ba.materials[b]={},ia[b]={prog:0,fileSize:d.fileSize},pa+=d.fileSize,Q++)}}if(a.geometries){ba.geometries={};for(var b in a.geometries)a.geometries[b].path&&a.geometries[b].fileSize&&(ba.geometries[b]={},ja[b]={prog:0,fileSize:a.geometries[b].fileSize},qa+=a.geometries[b].fileSize,Q++)}if(a.animations){ba.animations={};for(var b in a.animations)a.animations[b].path&&a.animations[b].fileSize&&(ba.animations[b]={},ka[b]={prog:0,fileSize:a.animations[b].fileSize},ra+=a.animations[b].fileSize,Q++)}if(a.objects){ba.objects={};for(var b in a.objects)a.objects[b].path&&a.objects[b].fileSize&&(ba.objects[b]={},la[b]={prog:0,fileSize:a.objects[b].fileSize},sa+=a.objects[b].fileSize,Q++)}if(a.files)for(var b in a.files)a.files[b].path&&a.files[b].fileSize&&g(b);if(a.fonts)for(var b in a.fonts)a.fonts[b].path&&a.fonts[b].fileSize&&h(b);if(a.textures)for(var b in a.textures)a.textures[b].path&&a.textures[b].fileSize&&i(b);if(a.materials)for(var b in a.materials)a.materials[b].path&&a.materials[b].fileSize&&j(b);if(a.geometries)for(var b in a.geometries)a.geometries[b].path&&a.geometries[b].fileSize&&l(b);if(a.animations)for(var b in a.animations)a.animations[b].path&&a.animations[b].fileSize&&m(b);if(a.objects)for(var b in a.objects)a.objects[b].path&&a.objects[b].fileSize&&n(b)}function g(a){var b=b||new THREE.FileLoader;b.load(C.resources.files[a].path,function(b){ba.files[a]=b,ea[a].prog=1,P++,y({type:"File",name:a,progress:1}),z(!0)},function(b){var c=b.loaded/b.total;ja[a].prog=c,1!==c&&y({type:"File",name:a,progress:c}),z()})}function h(a){X.main=X.main||new THREE.TTFLoader,X.main.load(C.resources.fonts[a].path,function(b){ba.fonts[a]=b,fa[a].prog=1,P++,y({type:"Font",name:a,progress:1}),z(!0)},function(b){var c=b.loaded/b.total;fa[a].prog=c,1!==c&&y({type:"Font",name:a,progress:c}),z()})}function i(a){var b=C.resources.textures[a],c,d;"string"==typeof b.path?(c=b.path.split("."),d=c[c.length-1]):(c=b.path[0].split("."),d="hdr"===c[c.length-1].toLowerCase()?"cubehdr":"cube"),o(d.toLowerCase()).load(b.path,function(b){ba.textures[a]=b,ha[a].prog=1,P++,y({type:"Texture",name:a,progress:1}),z(!0)},function(b){var c=b.loaded/b.total;ha[a].prog=c,1!==c&&y({type:"Texture",name:a,progress:c}),z()})}function j(a){var b=C.resources.materials[a],c=b.path.split("."),d=c[c.length-1];p(d.toLowerCase()).load(b.path,function(b){if(ba.materials[a]=b,ia[a].prog=1,P++,y({type:"Material",name:a,progress:1}),z(!0),b instanceof THREE.MTLLoader.MaterialCreator){var c=C.resources.objects;if(c)for(var d in c){var e=c.path.split(".");e=e[e.length-1],c[d].setMaterials===a&&"obj"===e&&n(d,b)}}},function(b){var c=b.loaded/b.total;ia[a].prog=c,1!==c&&y({type:"Material",name:a,progress:c}),z()})}function l(a){var b=C.resources.geometries[a],c=b.path.split("."),d=c[c.length-1];q(d.toLowerCase()).load(b.path,function(b){ba.geometries[a]=b,ja[a].prog=1,P++,y({type:"Geometry",name:a,progress:1}),z(!0)},function(b){var c=b.loaded/b.total;ja[a].prog=c,1!==c&&y({type:"Geometry",name:a,progress:c}),z()})}function m(a){var b=C.resources.animations[a];_=_||new THREE.BVHLoader,_.load(b.path,function(b){ba.animations[a]=b,ka[a].prog=1,P++,y({type:"Animation",name:a,progress:1}),z(!0)},function(b){var c=b.loaded/b.total;ka[a].prog=c,1!==c&&y({type:"Animation",name:a,progress:c}),z()})}function n(a,b){var c=C.resources.objects[a],d=c.path.split("."),e=d.length,f="assimp"===d[e-2].toLowerCase()?"assimpJSON":d[e-1];if("obj"!==f||!c.setMaterials){var g=function(b,c){var d="assimp"===f?c:b;ba.objects[a]=d,la[a].prog=1,P++,y({type:"Object",name:a,progress:1}),z(!0)},h=function(b){var c=b.loaded/b.total;la[a].prog=c,1!==c&&y({type:"Object",name:a,progress:c}),z()};if(b){var i=new THREE.OBJLoader;i.setMaterials(b.preload()),i.load(c.path,g,h)}else{var i=r(f.toLowerCase());switch(f){case"mmd":i.load(c.path,c.vmdPaths,g,h);break;case"dae":c.convertUpAxis&&(i.convertUpAxis=c.convertUpAxis);default:i.load(c.path,g,h)}}}}function o(a){switch(a){case"tga":return Y.tga=Y.tga||new THREE.TGALoader,Y.tga;case"pvr":return Y.pvr=Y.pvr||new THREE.PVRLoader,Y.pvr;case"ktx":return Y.ktx=Y.ktx||new THREE.KTXLoader,Y.ktx;case"cubehdr":return Y.hdr=Y.hdr||new THREE.HDRCubeTextureLoader,Y.hdr;case"cube":return Y.cube=Y.cube||new THREE.CubeTextureLoader,Y.cube;default:return Y.main=Y.main||new THREE.TextureLoader,Y.main}}function p(a){switch(a){case"js":case"json":return Z.main=Z.main||new THREE.MaterialLoader,Z.main;case"mtl":return Z.mat=Z.mat||new THREE.MTLLoader,Z.mat}}function q(a){switch(a){case"ctm":return $.ctm=$.ctm||new THREE.CTMLoader,$.ctm;case"json":return $.json=$.json||new THREE.JSONLoader,$.json;case"ply":return $.ply=$.ply||new THREE.PLYLoader,$.ply;case"stl":return $.stl=$.stl||new THREE.STLLoader,$.stl;case"vtk":return $.vtk=$.vtk||new THREE.VTKLoader,$.vtk}}function r(a){switch(a){case"3mf":return aa.threemf||(aa.threemf=new THREE.ThreeMFLoader),aa.threemf;case"amf":return aa.amf||(aa.amf=new THREE.AMFLoader),aa.amf;case"assimp":return aa.assimp||(aa.assimp=new THREE.AssimpLoader),aa.assimp;case"assimpJSON":return aa.assimpJSON||(aa.assimpJSON=new THREE.AssimpJSONLoader),aa.assimpJSON;case"awd":return aa.awd||(aa.awd=new THREE.AWDLoader),aa.awd;case"babylon":return aa.babylon||(aa.babylon=new THREE.BabylonLoader),aa.babylon;case"bin":return aa.bin||(aa.bin=new THREE.BinaryLoader),aa.bin;case"dae":return aa.dae||(aa.dae=new THREE.ColladaLoader),aa.dae;case"fbx":return aa.fbx||(aa.fbx=new THREE.FBXLoader),aa.fbx;case"gltf":return aa.gltf||(aa.gltf=new THREE.GLTFLoader),aa.gltf;case"js":case"json":return aa.main||(aa.main=new THREE.ObjectLoader),aa.main;case"obj":return aa.obj||(aa.obj=new THREE.OBJLoader),aa.obj;case"pcd":return aa.pcd||(aa.pcd=new THREE.PCDLoader),aa.pcd;case"utf8":return aa.utf8||(aa.utf8=new THREE.UTF8Loader),aa.utf8;case"wrl":case"wrz":case"vrml":return aa.vrml||(aa.vrml=new THREE.VRMLLoader),aa.vrml}}function s(b){return"undefined"==typeof da[b]&&(ca=ca||a.context.getSupportedExtensions(),"PVR"===b?da[b]=ca.indexOf("WEBGL_compressed_texture_pvrtc")>-1||ca.indexOf("WEBKIT_WEBGL_compressed_texture_pvrtc")>-1:da[b]=ca.indexOf("WEBGL_compressed_texture_etc1")>-1),da[b]}function t(){E&&console.time("Processing duration");var b=C.resources.files,c=ba.files;if(b)for(var d in c){for(var e in b[d])"undefined"!=typeof c[d][e]&&(c[d][e]=b[d][e]);b[d].onComplete&&b[d].onComplete(c[d]),b[d]=c[d],b[d].name=d,delete c[d]}var f=C.resources.fonts,g=ba.fonts;if(f)for(var d in g){g[d]=new THREE.Font(g[d]);for(var e in f[d])"undefined"!=typeof g[d][e]&&(g[d][e]=f[d][e]);f[d]=g[d],f[d].name=d,delete g[d]}var h=C.resources.textures,i=ba.textures;if(h)for(var d in i){if(h[d].toPMREM){E&&console.time("Texture > "+d+" > PMREM creation time");var j=new THREE.PMREMGenerator(i[d]);j.update(a);var k=new THREE.PMREMCubeUVPacker(j.cubeLods);k.update(a),i[d]=k.CubeUVRenderTarget.texture,E&&console.timeEnd("Texture > "+d+" > PMREM creation time")}for(var e in h[d])"undefined"!=typeof i[d][e]&&(i[d][e]=h[d][e]);h[d]=i[d],h[d].name=d,delete i[d]}var l=C.resources.materials,m=ba.materials;if(l)for(var d in m){for(var e in l[d])"undefined"!=typeof m[d][e]&&(m[d][e]=l[d][e]);l[d].onComplete&&l[d].onComplete(m[d]),l[d]=m[d],l[d].name=d,delete m[d]}var n=C.resources.geometries,o=ba.geometries;if(n)for(var d in o)n[d].toBufferGeometry&&"BufferGeometry"!==o[d].type&&(o[d]=(new THREE.BufferGeometry).fromGeometry(o[d])),n[d].onComplete&&ga[d].onComplete(o[d]),n[d]=o[d],n[d].name=d,delete o[d];var p=C.resources.animations,q=ba.animations;if(p)for(var d in q)p[d].onComplete&&ga[d].onComplete(q[d]),p[d]=q[d],p[d].name=d,delete q[d];var r=C.resources.objects,s=ba.objects;if(r){var t=function(a,b){for(var c in r[a])"type"!==c&&"undefined"!=typeof b[c]&&(c.indexOf("map")>-1||c.indexOf("Map")>-1?b[c]=h[r[a][c]]:["emissive","color"].indexOf(c)>-1&&!r[a][c]instanceof THREE.Color?b[c]=new THREE.Color(r[a][c]):b[c]=r[a][c],delete r[a][c])},u=function(a,b,c){var d;switch(r[a].type){case"mesh":d=new THREE.Mesh(z,A);break;case"points":d=new THREE.Points(z,A);break;case"line":d=new THREE.Line(z,A);break;default:d=new THREE.Mesh(z,A)}return delete r[a].type,d},v=function(a,b){for(var c in r[a])"undefined"!=typeof b[c]?b[c]=r[a][c]:b.userData[c]=r[a][c],delete r[a]};for(var d in r)if(r[d].path&&r[d].fileSize){var e=r[d].path,w=e.split("."),x=w.length,y;y="assimp"===w[x-2]?s[d].object:"dae"===w[x-1]?s[d].scene:"gltf"===w[x-1]?"undefined"!=typeof s[d].scene?s[d].scene:s[d].scenes[0]:s[d],t(d,y.material),v(d,y),r[d].onComplete&&r[d].onComplete(y),r[d]=y,r[d].name=d,delete s[d]}else if("string"==typeof r[d].geometry){var z=C.resources.geometries[r[d].geometry],A=r[d].material;delete r[d].geometry,delete r[d].material,t(d,A);var y=u(d,z,A);v(d,y),r[d].onComplete&&r[d].onComplete(y),r[d]=y,r[d].name=d}else if(!r[d]instanceof THREE.Object3D){var z=r[d].geometry,A=r[d].material;delete r[d].geometry,delete r[d].material,t(d,r[d].material);var y=u(d,z,A);v(d,y),r[d].onComplete&&r[d].onComplete(y),r[d]=y,r[d].name=d}}E&&console.timeEnd("Processing duration")}function u(){var c=document.createElement("div"),d=document.createElement("div");c.style.cssText="background: "+b.background+";position: relative;overflow: hidden;";var e=b.size.indexOf("%")>-1?"%":"px",f=parseInt(b.size)/2+e;d.style.cssText="width: "+b.size+";top: 50%; left: 50%;margin-left: -"+f+";text-align: center;position: relative;display: inline-block",C.domElement=c,C.infoContainer=d,C.setSize(a.domElement.width,a.domElement.height),a.domElement.parentNode.appendChild(c)}function v(){switch(b.textInfo&&(R=document.createElement("p"),R.textContent="string"==typeof b.textInfo?b.textInfo:b.textInfo[0],R.style.cssText="color: "+b.infoColor+";display: inline-block;font-family: monospace;font-size: 12px"),b.sizeInfo&&(S=document.createElement("p"),S.textContent="0.00 MB",S.style.cssText="color: "+b.infoColor+";font-family: monospace;font-size: 12px;display: inline-block;"),b.percentInfo&&(T=document.createElement("p"),T.textContent="0 %",T.style.cssText="color: "+b.infoColor+";font-family: monospace;font-size: 12px;display: inline-block;"),b.type){case"bar":w();break;case"circular":x();break;default:w()}}function w(){if(b.progressInfo){var a=document.createElement("div"),c=document.createElement("div");a.style.cssText="background: "+b.progressBarContainer+";border: solid 1px "+b.progressBarContainer+";width: 100%; height: "+b.weight+";box-sizing: border-box;position: relative;",c.style.cssText="background: "+b.progressBar+";width: 0%; height: 100%;top: 0; left: 0;position: absolute;",a.appendChild(c)}b.textInfo&&C.infoContainer.appendChild(R),b.progressInfo&&C.infoContainer.appendChild(a),b.percentInfo&&C.infoContainer.appendChild(T),b.sizeInfo&&C.infoContainer.appendChild(S);var d=function(){b.progressInfo&&(c.style.width=(100*K.progress.value).toString()+"%"),b.sizeInfo&&(S.textContent=(K.progress.value*(oa+qa)/1024).toFixed(2)+" MB"),b.percentInfo&&(T.textContent=(100*K.progress.value).toFixed(0)+" %")};K.progress={key:"progress",duration:G,targetValue:I,initialValue:0,value:0,onUpdate:d},L.push(function(){K.progress.initialValue=K.progress.value,K.progress.targetValue=I,K.progress.duration=G})}function x(){if(b.progressInfo){var a="<svg style='width: 100%; height: 100%;' width=200 height=200 viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>\t<circle fill="+b.progressBarContainer+" cx='0' cy='0' transform='translate(100,100)'  r='"+(80+parseInt(b.weight)/2+2).toString()+"'/>\t<circle fill="+b.background+" cx='0' cy='0' transform='translate(100,100)'  r='"+(80-parseInt(b.weight)/2-2).toString()+"'/>\t<circle fill='none' cx='0' cy='0' transform='translate(100,100) rotate(-90)' r='80' stroke-dashoffset='1503'/></svg>";C.infoContainer.innerHTML=a;var c=C.infoContainer.firstElementChild.lastElementChild;c.style.cssText="stroke:"+b.progressBar+";stroke-width:"+parseInt(b.weight)+";stroke-dasharray:502;"}if(b.textInfo||b.sizeInfo){var d;if(b.progressInfo){var e=document.createElement("div");e.style.cssText="width: 100%; left: 50%; top: 50%;margin-left: -50%;position: absolute;",C.infoContainer.appendChild(e),d=e}else d=C.infoContainer;b.textInfo&&d.appendChild(R),b.sizeInfo&&d.appendChild(S),b.percentInfo&&d.appendChild(T),R.style.display=S.style.display="block"}var f=function(){b.progressInfo&&c.setAttribute("stroke-dashoffset",(502*(1-K.progress.value)).toString()),b.sizeInfo&&(S.textContent=(K.progress.value*(oa+qa)/1024).toFixed(2)+" MB"),b.percentInfo&&(T.textContent=(100*K.progress.value).toFixed(0)+" %")};K.progress={key:"progress",duration:G,targetValue:I,initialValue:0,value:0,onUpdate:f},L.push(function(){K.progress.initialValue=K.progress.value,K.progress.targetValue=I,K.progress.duration=G})}function y(a){var b=0,c=0,d=0,e=0,f=0,g=0,h=0;for(var i in ea)b+=ea[i].prog*ea[i].fileSize;for(var i in fa)c+=fa[i].prog*fa[i].fileSize;for(var i in ha)d+=ha[i].prog*ha[i].fileSize;for(var i in ia)e+=ia[i].prog*ia[i].fileSize;for(var i in ja)f+=ja[i].prog*ja[i].fileSize;for(var i in ka)g+=ka[i].prog*ka[i].fileSize;for(var i in la)h+=la[i].prog*la[i].fileSize;I=(b+c+d+e+f+g+h)/(ma+na+oa+pa+qa+ra+sa),"undefined"!=typeof a&&E&&console.info("Progress = "+I+", "+a.type+" > "+a.name+" > "+Math.round(100*a.progress)+"%"),z()}function z(a){for(var c=0;c<L.length;c++)L[c](I);if(1===I&&a){E&&console.timeEnd("Loading duration");var d=function(){C.resources?"custom"!==b.type&&b.textInfo?(R.textContent="string"==typeof b.textInfo?b.textInfo:b.textInfo[1],setTimeout(function(){t(),R.textContent="string"==typeof b.textInfo?b.textInfo:b.textInfo[2],setTimeout(A,20)},20)):(t(),A()):B()};"custom"!==b.type?K.progress.onComplete=function(){1===K.progress.value&&d()}:d()}}function A(){ta=new THREE.Scene,ua=new THREE.OrthographicCamera((-1),1,1,(-1),0,2);for(var b in C.resources.objects)ta.add(C.resources.objects[b]);E&&console.time("Compiling duration"),"undefined"==typeof a.compile?(va=new THREE.WebGLRenderTarget(1,1,{generateMipmaps:!0}),a.render(ta,ua,va),va.dispose()):a.compile(ta,ua);for(var b in C.resources.objects)ta.remove(C.resources.objects[b]);E&&console.timeEnd("Compiling duration"),B()}function B(){"custom"!==b.type&&b.textInfo&&(R.textContent="string"==typeof b.textInfo?b.textInfo:b.textInfo[3],setTimeout(function(){E&&console.time("Scene creation duration");for(var a=0;a<M.length;a++)M[a]();E&&console.timeEnd("Scene creation duration")},20))}var C=this,D=null,E=!1,F=!1,G=.5,H=3,I=0,J=!1,K={},L=[],M=[],N,O,P=0,Q=0,R,S,T,U,V,W,X={},Y={},Z={},$={},_,aa={},ba={},ca,da={},ea={},fa={},ha={},ia={},ja={},ka={},la={},ma=0,na=0,oa=0,pa=0,qa=0,ra=0,sa=0,ta,ua,va;return this.domElement=null,this.infoContainer=null,this.resources=null,this.setSize=e,b=b||{},b={type:"undefined"!=typeof b.type?b.type:"progress-bar",size:b.size||"150px",background:"undefined"!=typeof b.background?b.background:"#333",progressBarContainer:b.progressBarContainer||"#444",progressBar:b.progressBar||"#fb0",weight:b.weight||"6px",infoColor:b.infoColor||"#666",sizeInfo:"undefined"==typeof b.sizeInfo||b.sizeInfo,percentInfo:"undefined"!=typeof b.percentInfo&&b.percentInfo,progressInfo:"undefined"==typeof b.progressInfo||b.progressInfo,textInfo:"undefined"!=typeof b.textInfo?b.textInfo:["Loading","Processing","Compiling","Creating scene"]},u(),"custom"!==b.type&&v(),this.start=function(d){var e=function(){if("custom"!==b){C.domElement.appendChild(C.infoContainer);var a=-parseInt(getComputedStyle(C.infoContainer,null).height)/2;if(C.infoContainer.style.marginTop=a+"px",b.progressInfo&&"circular"===b.type){var e=-parseInt(getComputedStyle(C.infoContainer.lastElementChild,null).height)/2;C.infoContainer.lastElementChild.style.marginTop=e+"px"}c()}E&&console.time("Total load screen duration"),d&&(E&&console.time("Loading duration"),C.resources=d,f())};if(F)e();else{var g=function(){var b=a.domElement.getBoundingClientRect(),c=b.top,d=b.height;c<innerHeight&&c+d>0&&(window.removeEventListener("scroll",g),e())};window.addEventListener("scroll",g),g()}return C},this.remove=function(e){"custom"!==b.type?(c(),K.disappear={key:"opacity",duration:G,targetValue:0,initialValue:1,value:1,onUpdate:function(){C.infoContainer.style.opacity=K.disappear.value},onComplete:function(){d(e),H?K.exposure={key:"exposure",duration:H,targetValue:1,initialValue:0,value:0,onUpdate:function(){a.toneMappingExposure=K.exposure.value},onComplete:function(){cancelAnimationFrame(N)}}:cancelAnimationFrame(N),delete K.disappear}}):d(e)},this.setProgress=function(a){I=a,z(!0)},this.setOptions=function(a){return H="undefined"!=typeof a.autoTweenExposure?a.autoTweenExposure:H,F="undefined"!=typeof a.forcedStart?a.forcedStart:F,G="undefined"!=typeof a.tweenDuration?a.tweenDuration:G,E="undefined"!=typeof a.verbose?a.verbose:E,C},this.onProgress=function(){for(var a=0;a<arguments.length;a++)arguments[a]&&"function"==typeof arguments[a]&&L.push(arguments[a]);return C},this.onComplete=function(){for(var a=0;a<arguments.length;a++)arguments[a]&&"function"==typeof arguments[a]&&M.push(arguments[a]);return C},this}