function LoadScreen(a,b){"use strict";function c(){J=requestAnimationFrame(c);for(k in G){var a=G[k],b=(a.targetValue-a.initialValue)/F/60;a.value=a.targetValue>=a.initialValue?Math.min(a.targetValue,a.value+b):Math.max(a.targetValue,a.value+b),"function"==typeof a.onUpdate&&a.onUpdate(),a.value===a.targetValue&&("function"==typeof a.onComplete&&a.onComplete(),"progress"===k&&1===a.value&&(delete G.progress,cancelAnimationFrame(J)))}}function d(a){B&&console.timeEnd("Total load screen duration"),z.domElement.parentNode.removeChild(z.domElement),E=!0,a&&"function"==typeof a&&a()}function e(a,b){E||(z.domElement.style.marginTop="-"+b/devicePixelRatio+"px",z.domElement.style.height=b/devicePixelRatio+"px",z.domElement.style.width=a/devicePixelRatio+"px")}function f(){var a=z.resources;if(a.files){W.files={};for(var b in a.files){var c=a.files[b];c.path&&c.fileSize&&(W.files[b]={},ba[b]={prog:0,fileSize:d.fileSize},ha+=d.fileSize,M++)}}if(a.textures){W.textures={};for(var b in a.textures){var d=a.textures[b];d.path&&d.fileSize&&(W.textures[b]={},d.GPUCompression&&(d.GPUCompression.PVR&&o("PVR")?(d.path=d.GPUCompression.PVR.path,d.fileSize=d.GPUCompression.PVR.fileSize):d.GPUCompression.KTX&&o("KTX")&&(d.path=d.GPUCompression.KTX.path,d.fileSize=d.GPUCompression.KTX.fileSize)),Z[b]={prog:0,fileSize:d.fileSize},ca+=d.fileSize,M++)}}if(a.fonts){W.fonts={};for(var b in a.fonts){var c=a.fonts[b];c.path&&c.fileSize&&(W.fonts[b]={},$[b]={prog:0,fileSize:c.fileSize},da+=c.filesSize,M++)}}if(a.geometries){W.geometries={};for(var b in a.geometries)a.geometries[b].path&&a.geometries[b].fileSize&&(W.geometries[b]={},_[b]={prog:0,fileSize:a.geometries[b].fileSize},ea+=a.geometries[b].fileSize,M++)}if(a.objects){W.objects={};for(var b in a.objects)a.objects[b].path&&a.objects[b].fileSize&&(W.objects[b]={},aa[b]={prog:0,fileSize:a.objects[b].fileSize},fa+=a.objects[b].fileSize,M++)}if(a.files)for(var b in a.files)a.files[b].path&&a.files[b].fileSize&&h(b);if(a.textures)for(var b in a.textures)a.textures[b].path&&a.textures[b].fileSize&&i(b);if(a.fonts)for(var b in a.fonts)a.fonts[b].path&&a.fonts[b].fileSize&&j(b);if(a.geometries)for(var b in a.geometries)a.geometries[b].path&&a.geometries[b].fileSize&&g(b);if(a.objects)for(var b in a.objects)a.objects[b].path&&a.objects[b].fileSize&&l(b)}function g(a){var b=z.resources.geometries[a],c=b.path.split("."),d=c[c.length-1];p(d).load(b.path,function(b){W.geometries[a]=b,_[a].prog=1,L++,v({type:"Geometry",name:a,progress:1}),w(!0)},function(b){var c=b.loaded/b.total;_[a].prog=c,1!==c&&v({type:"Geometry",name:a,progress:c}),w()})}function h(a){var b=b||new THREE.FileLoader;b.load(z.resources.files[a].path,function(b){W.files[a]=b,ba[a].prog=1,L++,v({type:"File",name:a,progress:1}),w(!0)},function(b){var c=b.loaded/b.total;_[a].prog=c,1!==c&&v({type:"File",name:a,progress:c}),w()})}function i(a){var b=z.resources.textures[a],c,d;"string"==typeof b.path?(c=b.path.split("."),d=c[c.length-1]):(c=b.path[0].split("."),d="hdr"===c[c.length-1]?"cubehdr":"cube"),n(d).load(b.path,function(b){W.textures[a]=b,Z[a].prog=1,L++,v({type:"Texture",name:a,progress:1}),w(!0)},function(b){var c=b.loaded/b.total;Z[a].prog=c,1!==c&&v({type:"Texture",name:a,progress:c}),w()})}function j(a){S.main=S.main||new THREE.TTFLoader,S.main.load(z.resources.fonts[a].path,function(b){W.fonts[a]=b,$[a].prog=1,L++,v({type:"Font",name:a,progress:1}),w(!0)},function(b){var c=b.loaded/b.total;$[a].prog=c,1!==c&&v({type:"Font",name:a,progress:c}),w()})}function l(a){var b=z.resources.objects[a],c=b.path.split("."),d=c.length,e="assimp"===c[d-2]?"assimpJSON":c[d-1],f=m(e),g=function(b,c){var d="assimp"===e?c:b;W.objects[a]=d,aa[a].prog=1,L++,v({type:"Object",name:a,progress:1}),w(!0)},h=function(b){var c=b.loaded/b.total;aa[a].prog=c,1!==c&&v({type:"Object",name:a,progress:c}),w()};switch(e){case"mmd":f.load(b.path,b.vmdPaths,g,h);break;case"dae":b.convertUpAxis&&(f.convertUpAxis=b.convertUpAxis);default:f.load(b.path,g,h)}}function m(a){switch(a){case"3mf":return U.threemf||(U.threemf=new THREE.ThreeMFLoader),U.threemf;case"amf":return U.amf||(U.amf=new THREE.AMFLoader),U.amf;case"assimp":return U.assimp||(U.assimp=new THREE.AssimpLoader),U.assimp;case"assimpJSON":return U.assimpJSON||(U.assimpJSON=new THREE.AssimpJSONLoader),U.assimpJSON;case"awd":return U.awd||(U.awd=new THREE.AWDLoader),U.awd;case"babylon":return U.babylon||(U.babylon=new THREE.BabylonLoader),U.babylon;case"dae":return U.dae||(U.dae=new THREE.ColladaLoader),U.dae;case"fbx":return U.fbx||(U.fbx=new THREE.FBXLoader),U.fbx;case"gltf":return U.gltf||(U.gltf=new THREE.GLTFLoader),U.gltf;case"obj":return U.obj||(U.obj=new THREE.OBJLoader),U.obj;case"pcd":return U.pcd||(U.pcd=new THREE.PCDLoader),U.pcd;case"utf8":return U.utf8||(U.utf8=new THREE.UTF8Loader),U.utf8;case"wrl":case"wrz":case"vrml":return U.vrml||(U.vrml=new THREE.VRMLLoader),U.vrml}}function n(a){switch(a){case"tga":return R.tga=R.tga||new THREE.TGALoader,R.tga;case"pvr":return R.pvr=R.pvr||new THREE.PVRLoader,R.pvr;case"ktx":return R.ktx=R.ktx||new THREE.KTXLoader,R.ktx;case"cubehdr":return R.hdr=R.hdr||new THREE.HDRCubeTextureLoader,R.hdr;case"cube":return R.cube=R.cube||new THREE.CubeTextureLoader,R.cube;default:return R.main=R.main||new THREE.TextureLoader,R.main}}function o(b){return"undefined"==typeof Y[b]&&(X=X||a.context.getSupportedExtensions(),"PVR"===b?Y[b]=X.indexOf("WEBGL_compressed_texture_pvrtc")>-1||X.indexOf("WEBKIT_WEBGL_compressed_texture_pvrtc")>-1:Y[b]=X.indexOf("WEBGL_compressed_texture_etc1")>-1),Y[b]}function p(a){switch(a){case"ctm":return T.ctm=T.ctm||new THREE.CTMLoader,T.ctm;case"json":return T.json=T.json||new THREE.JSONLoader,T.json;case"ply":return T.ply=T.ply||new THREE.PLYLoader,T.ply;case"stl":return T.stl=T.stl||new THREE.STLLoader,T.stl;case"vtk":return T.vtk=T.vtk||new THREE.VTKLoader,T.vtk}}function q(){B&&console.time("Processing duration");var b=z.resources.files,c=W.files;if(b)for(var d in c){for(var e in b[d])"undefined"!=typeof c[d][e]&&(c[d][e]=b[d][e]);b[d].onComplete&&b[d].onComplete(c[d]),b[d]=c[d],b[d].name=d,delete c[d]}var f=z.resources.textures,g=W.textures;if(f)for(var d in g){if(f[d].toPMREM){var h=new THREE.PMREMGenerator(g[d]);h.update(a);var i=new THREE.PMREMCubeUVPacker(h.cubeLods);i.update(a),g[d]=i.CubeUVRenderTarget.texture}for(var e in f[d])"undefined"!=typeof g[d][e]&&(g[d][e]=f[d][e]);f[d]=g[d],f[d].name=d,delete g[d]}var b=z.resources.fonts,c=W.fonts;if(b)for(var d in c){c[d]=new THREE.Font(c[d]);for(var e in b[d])"undefined"!=typeof c[d][e]&&(c[d][e]=b[d][e]);b[d]=c[d],b[d].name=d,delete c[d]}var j=z.resources.geometries,k=W.geometries;if(j)for(var d in k)j[d].toBufferGeometry&&"BufferGeometry"!==k[d].type&&(k[d]=(new THREE.BufferGeometry).fromGeometry(k[d])),j[d].onComplete&&ga[d].onComplete(k[d]),j[d]=k[d],j[d].name=d,delete k[d];var l=z.resources.objects,m=W.objects;if(l){var n=function(a,b){for(var c in l[a])"type"!==c&&"undefined"!=typeof b[c]&&(c.indexOf("map")>-1||c.indexOf("Map")>-1?b[c]=f[l[a][c]]:["emissive","color"].indexOf(c)>-1&&!l[a][c]instanceof THREE.Color?b[c]=new THREE.Color(l[a][c]):b[c]=l[a][c],delete l[a][c])},o=function(a,b,c){var d;switch(l[a].type){case"mesh":d=new THREE.Mesh(t,u);break;case"points":d=new THREE.Points(t,u);break;case"line":d=new THREE.Line(t,u);break;default:d=new THREE.Mesh(t,u)}return delete l[a].type,d},p=function(a,b){for(var c in l[a])"undefined"!=typeof b[c]?b[c]=l[a][c]:b.userData[c]=l[a][c],delete l[a]};for(var d in l)if(l[d].path&&l[d].fileSize){var e=l[d].path,q=e.split("."),r=q.length,s;s="assimp"===q[r-2]?m[d].object:"dae"===q[r-1]?m[d].scene:"gltf"===q[r-1]?"undefined"!=typeof m[d].scene?m[d].scene:m[d].scenes[0]:m[d],n(d,s.material),p(d,s),l[d].onComplete&&l[d].onComplete(s),l[d]=s,l[d].name=d,delete m[d]}else if("string"==typeof l[d].geometry){var t=z.resources.geometries[l[d].geometry],u=l[d].material;delete l[d].geometry,delete l[d].material,n(d,u);var s=o(d,t,u);p(d,s),l[d].onComplete&&l[d].onComplete(s),l[d]=s,l[d].name=d}else if(!l[d]instanceof THREE.Object3D){var t=l[d].geometry,u=l[d].material;delete l[d].geometry,delete l[d].material,n(d,l[d].material);var s=o(d,t,u);p(d,s),l[d].onComplete&&l[d].onComplete(s),l[d]=s,l[d].name=d}}B&&console.timeEnd("Processing duration")}function r(){var c=document.createElement("div"),d=document.createElement("div");c.style.cssText="background: "+b.background+";position: relative;overflow: hidden;";var e=b.size.indexOf("%")>-1?"%":"px",f=parseInt(b.size)/2+e;d.style.cssText="width: "+b.size+";top: 50%; left: 50%;margin-left: -"+f+";text-align: center;position: relative;display: inline-block",z.domElement=c,z.infoContainer=d,z.setSize(a.domElement.width,a.domElement.height),a.domElement.parentNode.appendChild(c)}function s(){switch(b.textInfo&&(N=document.createElement("p"),N.textContent="string"==typeof b.textInfo?b.textInfo:b.textInfo[0],N.style.cssText="color: "+b.infoColor+";display: inline-block;font-family: monospace;font-size: 12px"),b.sizeInfo&&(O=document.createElement("p"),O.textContent="0.00MB",O.style.cssText="color: "+b.infoColor+";font-family: monospace;font-size: 12px;display: inline-block;"),b.type){case"bar":t();break;case"circular":u();break;default:t()}}function t(){var a=document.createElement("div"),c=document.createElement("div");a.style.cssText="background: "+b.progressBarContainer+";border: solid 1px "+b.progressBarContainer+";width: 100%; height: "+b.weight+";box-sizing: border-box;position: relative;",c.style.cssText="background: "+b.progressBar+";width: 0%; height: 100%;top: 0; left: 0;position: absolute;",a.appendChild(c),b.textInfo&&z.infoContainer.appendChild(N),z.infoContainer.appendChild(a),b.sizeInfo&&z.infoContainer.appendChild(O);var d=function(){c.style.width=(100*G.progress.value).toString()+"%",b.sizeInfo&&(O.textContent=(G.progress.value*(ca+ea)/1024).toFixed(2)+" MB")};G.progress={key:"progress",duration:F,targetValue:D,initialValue:0,value:0,onUpdate:d},H.push(function(){G.progress.initialValue=G.progress.value,G.progress.targetValue=D,G.progress.duration+=F})}function u(){var a="<svg style='width: 100%; height: 100%;' width=200 height=200 viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>\t<circle fill="+b.progressBarContainer+" cx='0' cy='0' transform='translate(100,100)'  r='"+(80+parseInt(b.weight)/2+2).toString()+"'/>\t<circle fill="+b.background+" cx='0' cy='0' transform='translate(100,100)'  r='"+(80-parseInt(b.weight)/2-2).toString()+"'/>\t<circle fill='none' cx='0' cy='0' transform='translate(100,100) rotate(-90)' r='80' stroke-dashoffset='1503'/></svg>";z.infoContainer.innerHTML=a;var c=z.infoContainer.firstElementChild.lastElementChild;if(c.style.cssText="stroke:"+b.progressBar+";stroke-width:"+parseInt(b.weight)+";stroke-dasharray:502;",b.textInfo||b.sizeInfo){var d=document.createElement("div");d.style.cssText="width: 100%; left: 50%; top: 50%;margin-left: -50%;position: absolute;",z.infoContainer.appendChild(d),b.textInfo&&d.appendChild(N),b.sizeInfo&&d.appendChild(O),N.style.display=O.style.display="block"}var e=function(){c.setAttribute("stroke-dashoffset",(502*(1-G.progress.value)).toString()),b.sizeInfo&&(O.textContent=(G.progress.value*(ca+ea)/1024).toFixed(2)+" MB")};G.progress={key:"progress",duration:F,targetValue:D,initialValue:0,value:0,onUpdate:e},H.push(function(){G.progress.initialValue=G.progress.value,G.progress.targetValue=D,G.progress.duration+=F})}function v(a){var b=0,c=0,d=0,e=0,f=0;for(var g in ba)b+=ba[g].prog*ba[g].fileSize;for(var g in Z)b+=Z[g].prog*Z[g].fileSize;for(var g in cubeTextures)f+=cubeTextures[g].prog*cubeTextures[g].fileSize;for(var g in _)c+=_[g].prog*_[g].fileSize;for(var g in aa)d+=aa[g].prog*aa[g].fileSize;D=(b+c+d+e)/(ca+ea+fa+ha),"undefined"!=typeof a&&B&&console.info("Progress = "+D+", "+a.type+" > "+a.name+" > "+Math.round(100*a.progress)+"%"),w()}function w(a){for(var c=0;c<H.length;c++)H[c](D);if(1===D&&a){B&&console.timeEnd("Loading duration");var d=function(){z.resources?"custom"!==b.type&&b.textInfo?(N.textContent="string"==typeof b.textInfo?b.textInfo:b.textInfo[1],setTimeout(function(){q(),N.textContent="string"==typeof b.textInfo?b.textInfo:b.textInfo[2],setTimeout(x,20)},20)):(q(),x()):y()};"custom"!==b.type?G.progress.onComplete=function(){1===G.progress.value&&d()}:d()}}function x(){var b=new THREE.Scene,c=new THREE.OrthographicCamera((-1),1,1,(-1),0,2),d=new THREE.WebGLRenderTarget(10,10,{generateMipmaps:!0});for(var e in z.resources.objects)b.add(z.resources.objects[e]);B&&console.time("Compiling duration"),a.render(b,c,d);for(var e in z.resources.objects)b.remove(z.resources.objects[e]);B&&console.timeEnd("Compiling duration"),d.dispose(),y()}function y(){"custom"!==b.type&&b.textInfo&&(N.textContent="string"==typeof b.textInfo?b.textInfo:b.textInfo[3],setTimeout(function(){B&&console.time("Scene creation duration");for(var a=0;a<I.length;a++)I[a]();B&&console.timeEnd("Scene creation duration")},20))}var z=this,A=null,B=!1,C=!1,D=0,E=!1,F=.5,G={},H=[],I=[],J,K,L=0,M=0,N,O,P,Q,R={},S={},T={},U={},V,W={},X,Y={},Z={},$={},_={},aa={},ba={},ca=0,da=0,ea=0,fa=0,ha=0;return this.domElement=null,this.infoContainer=null,this.resources=null,this.setSize=e,b=b||{},b={type:"undefined"!=typeof b.type?b.type:"bar",size:b.size?b.size:"150px",background:b.background?b.background:"#333",progressBarContainer:b.progressBarContainer?b.progressBarContainer:"#444",progressBar:b.progressBar?b.progressBar:"#fb0",weight:b.weight?b.weight:"6px",infoColor:b.infoColor?b.infoColor:"#666",sizeInfo:"undefined"==typeof b.sizeInfo||b.sizeInfo,textInfo:"undefined"!=typeof b.textInfo?b.textInfo:["Loading","Processing","Compiling","Creating scene"]},r(),"custom"!==b.type&&s(),this.start=function(a){if("custom"!==b){z.domElement.appendChild(z.infoContainer);var d=-parseInt(getComputedStyle(z.infoContainer,null).height)/2;if(z.infoContainer.style.marginTop=d+"px","circular"===b.type){var e=-parseInt(getComputedStyle(z.infoContainer.lastElementChild,null).height)/2;z.infoContainer.lastElementChild.style.marginTop=e+"px"}c()}return B&&console.time("Total load screen duration"),a&&(B&&console.time("Loading duration"),z.resources=a,f()),z},this.remove=function(a){"custom"!==b.type?(c(),G.disappear={key:"opacity",duration:F,targetValue:0,initialValue:1,value:1,onUpdate:function(){z.infoContainer.style.opacity=G.disappear.value},onComplete:function(){cancelAnimationFrame(J),d(a)}}):d(a)},this.setProgress=function(a){D=a,w(!0)},this.setOptions=function(a){return F="undefined"!=typeof a.tweenDuration?a.tweenDuration:F,C="undefined"!=typeof a.forcedStart?a.forcedStart:C,B="undefined"!=typeof a.verbose?a.verbose:B,z},this.onProgress=function(){for(var a=0;a<arguments.length;a++)arguments[a]&&"function"==typeof arguments[a]&&H.push(arguments[a]);return z},this.onComplete=function(){for(var a=0;a<arguments.length;a++)arguments[a]&&"function"==typeof arguments[a]&&I.push(arguments[a]);return z},this}