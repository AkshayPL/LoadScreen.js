function LoadScreen(a,b){"use strict";function c(){L=requestAnimationFrame(c);for(k in I){var a=I[k],b=(a.targetValue-a.initialValue)/H/60;a.value=a.targetValue>=a.initialValue?Math.min(a.targetValue,a.value+b):Math.max(a.targetValue,a.value+b),"function"==typeof a.onUpdate&&a.onUpdate(),a.value===a.targetValue&&("function"==typeof a.onComplete&&a.onComplete(),"progress"===k&&1===a.value&&(delete I.progress,cancelAnimationFrame(L)))}}function d(a){D&&console.timeEnd("Total load screen duration"),B.domElement.parentNode.removeChild(B.domElement),G=!0,a&&"function"==typeof a&&a()}function e(a,b){G||(B.domElement.style.marginTop="-"+b/devicePixelRatio+"px",B.domElement.style.height=b/devicePixelRatio+"px",B.domElement.style.width=a/devicePixelRatio+"px")}function f(){var a=B.resources;if(a.files){Z.files={};for(var b in a.files){var c=a.files[b];c.path&&c.fileSize&&(Z.files[b]={},aa[b]={prog:0,fileSize:d.fileSize},ha+=d.fileSize,O++)}}if(a.fonts){Z.fonts={};for(var b in a.fonts){var c=a.fonts[b];c.path&&c.fileSize&&(Z.fonts[b]={},ba[b]={prog:0,fileSize:c.fileSize},ia+=c.filesSize,O++)}}if(a.textures){Z.textures={};for(var b in a.textures){var d=a.textures[b];d.path&&d.fileSize&&(Z.textures[b]={},d.GPUCompression&&(d.GPUCompression.PVR&&q("PVR")?(d.path=d.GPUCompression.PVR.path,d.fileSize=d.GPUCompression.PVR.fileSize):d.GPUCompression.KTX&&q("KTX")&&(d.path=d.GPUCompression.KTX.path,d.fileSize=d.GPUCompression.KTX.fileSize)),ca[b]={prog:0,fileSize:d.fileSize},ja+=d.fileSize,O++)}}if(a.geometries){Z.geometries={};for(var b in a.geometries)a.geometries[b].path&&a.geometries[b].fileSize&&(Z.geometries[b]={},da[b]={prog:0,fileSize:a.geometries[b].fileSize},ka+=a.geometries[b].fileSize,O++)}if(a.animations){Z.animations={};for(var b in a.animations)a.animations[b].path&&a.animations[b].fileSize&&(Z.animations[b]={},ea[b]={prog:0,fileSize:a.animations[b].fileSize},la+=a.animations[b].fileSize,O++)}if(a.objects){Z.objects={};for(var b in a.objects)a.objects[b].path&&a.objects[b].fileSize&&(Z.objects[b]={},fa[b]={prog:0,fileSize:a.objects[b].fileSize},ma+=a.objects[b].fileSize,O++)}if(a.files)for(var b in a.files)a.files[b].path&&a.files[b].fileSize&&g(b);if(a.fonts)for(var b in a.fonts)a.fonts[b].path&&a.fonts[b].fileSize&&h(b);if(a.textures)for(var b in a.textures)a.textures[b].path&&a.textures[b].fileSize&&i(b);if(a.geometries)for(var b in a.geometries)a.geometries[b].path&&a.geometries[b].fileSize&&l(b);if(a.objects)for(var b in a.objects)a.objects[b].path&&a.objects[b].fileSize&&n(b)}function g(a){var b=b||new THREE.FileLoader;b.load(B.resources.files[a].path,function(b){Z.files[a]=b,aa[a].prog=1,N++,x({type:"File",name:a,progress:1}),y(!0)},function(b){var c=b.loaded/b.total;da[a].prog=c,1!==c&&x({type:"File",name:a,progress:c}),y()})}function h(a){U.main=U.main||new THREE.TTFLoader,U.main.load(B.resources.fonts[a].path,function(b){Z.fonts[a]=b,ba[a].prog=1,N++,x({type:"Font",name:a,progress:1}),y(!0)},function(b){var c=b.loaded/b.total;ba[a].prog=c,1!==c&&x({type:"Font",name:a,progress:c}),y()})}function i(a){var b=B.resources.textures[a],c,d;"string"==typeof b.path?(c=b.path.split("."),d=c[c.length-1]):(c=b.path[0].split("."),d="hdr"===c[c.length-1].toLowerCase()?"cubehdr":"cube"),p(d.toLowerCase()).load(b.path,function(b){Z.textures[a]=b,ca[a].prog=1,N++,x({type:"Texture",name:a,progress:1}),y(!0)},function(b){var c=b.loaded/b.total;ca[a].prog=c,1!==c&&x({type:"Texture",name:a,progress:c}),y()})}function j(a){}function l(a){var b=B.resources.geometries[a],c=b.path.split("."),d=c[c.length-1];r(d.toLowerCase()).load(b.path,function(b){Z.geometries[a]=b,da[a].prog=1,N++,x({type:"Geometry",name:a,progress:1}),y(!0)},function(b){var c=b.loaded/b.total;da[a].prog=c,1!==c&&x({type:"Geometry",name:a,progress:c}),y()})}function m(a){var b=B.resources.animations[a];W=W||new THREE.BVHLoader,W.load(b.path,function(b){Z.animations[a]=b,ea[a].prog=1,N++,x({type:"Animation",name:a,progress:1}),y(!0)},function(b){var c=b.loaded/b.total;ea[a].prog=c,1!==c&&x({type:"Animation",name:a,progress:c}),y()})}function n(a){var b=B.resources.objects[a],c=b.path.split("."),d=c.length,e="assimp"===c[d-2].toLowerCase()?"assimpJSON":c[d-1],f=o(e.toLowerCase()),g=function(b,c){var d="assimp"===e?c:b;Z.objects[a]=d,fa[a].prog=1,N++,x({type:"Object",name:a,progress:1}),y(!0)},h=function(b){var c=b.loaded/b.total;fa[a].prog=c,1!==c&&x({type:"Object",name:a,progress:c}),y()};switch(e){case"mmd":f.load(b.path,b.vmdPaths,g,h);break;case"dae":b.convertUpAxis&&(f.convertUpAxis=b.convertUpAxis);default:f.load(b.path,g,h)}}function o(a){switch(a){case"3mf":return Y.threemf||(Y.threemf=new THREE.ThreeMFLoader),Y.threemf;case"amf":return Y.amf||(Y.amf=new THREE.AMFLoader),Y.amf;case"assimp":return Y.assimp||(Y.assimp=new THREE.AssimpLoader),Y.assimp;case"assimpJSON":return Y.assimpJSON||(Y.assimpJSON=new THREE.AssimpJSONLoader),Y.assimpJSON;case"awd":return Y.awd||(Y.awd=new THREE.AWDLoader),Y.awd;case"babylon":return Y.babylon||(Y.babylon=new THREE.BabylonLoader),Y.babylon;case"dae":return Y.dae||(Y.dae=new THREE.ColladaLoader),Y.dae;case"fbx":return Y.fbx||(Y.fbx=new THREE.FBXLoader),Y.fbx;case"gltf":return Y.gltf||(Y.gltf=new THREE.GLTFLoader),Y.gltf;case"obj":return Y.obj||(Y.obj=new THREE.OBJLoader),Y.obj;case"pcd":return Y.pcd||(Y.pcd=new THREE.PCDLoader),Y.pcd;case"utf8":return Y.utf8||(Y.utf8=new THREE.UTF8Loader),Y.utf8;case"wrl":case"wrz":case"vrml":return Y.vrml||(Y.vrml=new THREE.VRMLLoader),Y.vrml}}function p(a){switch(a){case"tga":return V.tga=V.tga||new THREE.TGALoader,V.tga;case"pvr":return V.pvr=V.pvr||new THREE.PVRLoader,V.pvr;case"ktx":return V.ktx=V.ktx||new THREE.KTXLoader,V.ktx;case"cubehdr":return V.hdr=V.hdr||new THREE.HDRCubeTextureLoader,V.hdr;case"cube":return V.cube=V.cube||new THREE.CubeTextureLoader,V.cube;default:return V.main=V.main||new THREE.TextureLoader,V.main}}function q(b){return"undefined"==typeof _[b]&&($=$||a.context.getSupportedExtensions(),"PVR"===b?_[b]=$.indexOf("WEBGL_compressed_texture_pvrtc")>-1||$.indexOf("WEBKIT_WEBGL_compressed_texture_pvrtc")>-1:_[b]=$.indexOf("WEBGL_compressed_texture_etc1")>-1),_[b]}function r(a){switch(a){case"ctm":return X.ctm=X.ctm||new THREE.CTMLoader,X.ctm;case"json":return X.json=X.json||new THREE.JSONLoader,X.json;case"ply":return X.ply=X.ply||new THREE.PLYLoader,X.ply;case"stl":return X.stl=X.stl||new THREE.STLLoader,X.stl;case"vtk":return X.vtk=X.vtk||new THREE.VTKLoader,X.vtk}}function s(){D&&console.time("Processing duration");var b=B.resources.files,c=Z.files;if(b)for(var d in c){for(var e in b[d])"undefined"!=typeof c[d][e]&&(c[d][e]=b[d][e]);b[d].onComplete&&b[d].onComplete(c[d]),b[d]=c[d],b[d].name=d,delete c[d]}var f=B.resources.fonts,g=Z.fonts;if(f)for(var d in g){g[d]=new THREE.Font(g[d]);for(var e in f[d])"undefined"!=typeof g[d][e]&&(g[d][e]=f[d][e]);f[d]=g[d],f[d].name=d,delete g[d]}var h=B.resources.textures,i=Z.textures;if(h)for(var d in i){if(h[d].toPMREM){D&&console.time("Texture > "+d+" > PMREM creation time");var j=new THREE.PMREMGenerator(i[d]);j.update(a);var k=new THREE.PMREMCubeUVPacker(j.cubeLods);k.update(a),i[d]=k.CubeUVRenderTarget.texture,D&&console.timeEnd("Texture > "+d+" > PMREM creation time")}for(var e in h[d])"undefined"!=typeof i[d][e]&&(i[d][e]=h[d][e]);h[d]=i[d],h[d].name=d,delete i[d]}var l=B.resources.geometries,m=Z.geometries;if(l)for(var d in m)l[d].toBufferGeometry&&"BufferGeometry"!==m[d].type&&(m[d]=(new THREE.BufferGeometry).fromGeometry(m[d])),l[d].onComplete&&ga[d].onComplete(m[d]),l[d]=m[d],l[d].name=d,delete m[d];var n=B.resources.animations,o=Z.animations;if(n)for(var d in o)n[d].onComplete&&ga[d].onComplete(o[d]),n[d]=o[d],n[d].name=d,delete o[d];var p=B.resources.objects,q=Z.objects;if(p){var r=function(a,b){for(var c in p[a])"type"!==c&&"undefined"!=typeof b[c]&&(c.indexOf("map")>-1||c.indexOf("Map")>-1?b[c]=h[p[a][c]]:["emissive","color"].indexOf(c)>-1&&!p[a][c]instanceof THREE.Color?b[c]=new THREE.Color(p[a][c]):b[c]=p[a][c],delete p[a][c])},s=function(a,b,c){var d;switch(p[a].type){case"mesh":d=new THREE.Mesh(x,y);break;case"points":d=new THREE.Points(x,y);break;case"line":d=new THREE.Line(x,y);break;default:d=new THREE.Mesh(x,y)}return delete p[a].type,d},t=function(a,b){for(var c in p[a])"undefined"!=typeof b[c]?b[c]=p[a][c]:b.userData[c]=p[a][c],delete p[a]};for(var d in p)if(p[d].path&&p[d].fileSize){var e=p[d].path,u=e.split("."),v=u.length,w;w="assimp"===u[v-2]?q[d].object:"dae"===u[v-1]?q[d].scene:"gltf"===u[v-1]?"undefined"!=typeof q[d].scene?q[d].scene:q[d].scenes[0]:q[d],r(d,w.material),t(d,w),p[d].onComplete&&p[d].onComplete(w),p[d]=w,p[d].name=d,delete q[d]}else if("string"==typeof p[d].geometry){var x=B.resources.geometries[p[d].geometry],y=p[d].material;delete p[d].geometry,delete p[d].material,r(d,y);var w=s(d,x,y);t(d,w),p[d].onComplete&&p[d].onComplete(w),p[d]=w,p[d].name=d}else if(!p[d]instanceof THREE.Object3D){var x=p[d].geometry,y=p[d].material;delete p[d].geometry,delete p[d].material,r(d,p[d].material);var w=s(d,x,y);t(d,w),p[d].onComplete&&p[d].onComplete(w),p[d]=w,p[d].name=d}}D&&console.timeEnd("Processing duration")}function t(){var c=document.createElement("div"),d=document.createElement("div");c.style.cssText="background: "+b.background+";position: relative;overflow: hidden;";var e=b.size.indexOf("%")>-1?"%":"px",f=parseInt(b.size)/2+e;d.style.cssText="width: "+b.size+";top: 50%; left: 50%;margin-left: -"+f+";text-align: center;position: relative;display: inline-block",B.domElement=c,B.infoContainer=d,B.setSize(a.domElement.width,a.domElement.height),a.domElement.parentNode.appendChild(c)}function u(){switch(b.textInfo&&(P=document.createElement("p"),P.textContent="string"==typeof b.textInfo?b.textInfo:b.textInfo[0],P.style.cssText="color: "+b.infoColor+";display: inline-block;font-family: monospace;font-size: 12px"),b.sizeInfo&&(Q=document.createElement("p"),Q.textContent="0.00MB",Q.style.cssText="color: "+b.infoColor+";font-family: monospace;font-size: 12px;display: inline-block;"),b.type){case"bar":v();break;case"circular":w();break;default:v()}}function v(){var a=document.createElement("div"),c=document.createElement("div");a.style.cssText="background: "+b.progressBarContainer+";border: solid 1px "+b.progressBarContainer+";width: 100%; height: "+b.weight+";box-sizing: border-box;position: relative;",c.style.cssText="background: "+b.progressBar+";width: 0%; height: 100%;top: 0; left: 0;position: absolute;",a.appendChild(c),b.textInfo&&B.infoContainer.appendChild(P),B.infoContainer.appendChild(a),b.sizeInfo&&B.infoContainer.appendChild(Q);var d=function(){c.style.width=(100*I.progress.value).toString()+"%",b.sizeInfo&&(Q.textContent=(I.progress.value*(ja+ka)/1024).toFixed(2)+" MB")};I.progress={key:"progress",duration:H,targetValue:F,initialValue:0,value:0,onUpdate:d},J.push(function(){I.progress.initialValue=I.progress.value,I.progress.targetValue=F,I.progress.duration+=H})}function w(){var a="<svg style='width: 100%; height: 100%;' width=200 height=200 viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>\t<circle fill="+b.progressBarContainer+" cx='0' cy='0' transform='translate(100,100)'  r='"+(80+parseInt(b.weight)/2+2).toString()+"'/>\t<circle fill="+b.background+" cx='0' cy='0' transform='translate(100,100)'  r='"+(80-parseInt(b.weight)/2-2).toString()+"'/>\t<circle fill='none' cx='0' cy='0' transform='translate(100,100) rotate(-90)' r='80' stroke-dashoffset='1503'/></svg>";B.infoContainer.innerHTML=a;var c=B.infoContainer.firstElementChild.lastElementChild;if(c.style.cssText="stroke:"+b.progressBar+";stroke-width:"+parseInt(b.weight)+";stroke-dasharray:502;",b.textInfo||b.sizeInfo){var d=document.createElement("div");d.style.cssText="width: 100%; left: 50%; top: 50%;margin-left: -50%;position: absolute;",B.infoContainer.appendChild(d),b.textInfo&&d.appendChild(P),b.sizeInfo&&d.appendChild(Q),P.style.display=Q.style.display="block"}var e=function(){c.setAttribute("stroke-dashoffset",(502*(1-I.progress.value)).toString()),b.sizeInfo&&(Q.textContent=(I.progress.value*(ja+ka)/1024).toFixed(2)+" MB")};I.progress={key:"progress",duration:H,targetValue:F,initialValue:0,value:0,onUpdate:e},J.push(function(){I.progress.initialValue=I.progress.value,I.progress.targetValue=F,I.progress.duration+=H})}function x(a){var b=0,c=0,d=0,e=0,f=0;for(var g in aa)b+=aa[g].prog*aa[g].fileSize;for(var g in ca)b+=ca[g].prog*ca[g].fileSize;for(var g in cubeTextures)f+=cubeTextures[g].prog*cubeTextures[g].fileSize;for(var g in da)c+=da[g].prog*da[g].fileSize;for(var g in fa)d+=fa[g].prog*fa[g].fileSize;F=(b+c+d+e)/(ja+ka+ma+ha),"undefined"!=typeof a&&D&&console.info("Progress = "+F+", "+a.type+" > "+a.name+" > "+Math.round(100*a.progress)+"%"),y()}function y(a){for(var c=0;c<J.length;c++)J[c](F);if(1===F&&a){D&&console.timeEnd("Loading duration");var d=function(){B.resources?"custom"!==b.type&&b.textInfo?(P.textContent="string"==typeof b.textInfo?b.textInfo:b.textInfo[1],setTimeout(function(){s(),P.textContent="string"==typeof b.textInfo?b.textInfo:b.textInfo[2],setTimeout(z,20)},20)):(s(),z()):A()};"custom"!==b.type?I.progress.onComplete=function(){1===I.progress.value&&d()}:d()}}function z(){var b=new THREE.Scene,c=new THREE.OrthographicCamera((-1),1,1,(-1),0,2),d;for(var e in B.resources.objects)b.add(B.resources.objects[e]);D&&console.time("Compiling duration"),"undefined"==typeof a.compile?(d=new THREE.WebGLRenderTarget(10,10,{generateMipmaps:!0}),a.render(b,c,d),d.dispose()):a.compile(b,c);for(var e in B.resources.objects)b.remove(B.resources.objects[e]);D&&console.timeEnd("Compiling duration"),A()}function A(){"custom"!==b.type&&b.textInfo&&(P.textContent="string"==typeof b.textInfo?b.textInfo:b.textInfo[3],setTimeout(function(){D&&console.time("Scene creation duration");for(var a=0;a<K.length;a++)K[a]();D&&console.timeEnd("Scene creation duration")},20))}var B=this,C=null,D=!1,E=!1,F=0,G=!1,H=.5,I={},J=[],K=[],L,M,N=0,O=0,P,Q,R,S,T,U={},V={},W,X={},Y={},Z={},$,_={},aa={},ba={},ca={},da={},ea={},fa={},ha=0,ia=0,ja=0,ka=0,la=0,ma=0;return this.domElement=null,this.infoContainer=null,this.resources=null,this.setSize=e,b=b||{},b={type:"undefined"!=typeof b.type?b.type:"bar",size:b.size||"150px",background:b.background||"#333",progressBarContainer:b.progressBarContainer||"#444",progressBar:b.progressBar||"#fb0",weight:b.weight||"6px",infoColor:b.infoColor||"#666",sizeInfo:"undefined"==typeof b.sizeInfo||b.sizeInfo,textInfo:"undefined"!=typeof b.textInfo?b.textInfo:["Loading","Processing","Compiling","Creating scene"]},t(),"custom"!==b.type&&u(),this.start=function(a){if("custom"!==b){B.domElement.appendChild(B.infoContainer);var d=-parseInt(getComputedStyle(B.infoContainer,null).height)/2;if(B.infoContainer.style.marginTop=d+"px","circular"===b.type){var e=-parseInt(getComputedStyle(B.infoContainer.lastElementChild,null).height)/2;B.infoContainer.lastElementChild.style.marginTop=e+"px"}c()}return D&&console.time("Total load screen duration"),a&&(D&&console.time("Loading duration"),B.resources=a,f()),B},this.remove=function(a){"custom"!==b.type?(c(),I.disappear={key:"opacity",duration:H,targetValue:0,initialValue:1,value:1,onUpdate:function(){B.infoContainer.style.opacity=I.disappear.value},onComplete:function(){cancelAnimationFrame(L),d(a)}}):d(a)},this.setProgress=function(a){F=a,y(!0)},this.setOptions=function(a){return H="undefined"!=typeof a.tweenDuration?a.tweenDuration:H,E="undefined"!=typeof a.forcedStart?a.forcedStart:E,D="undefined"!=typeof a.verbose?a.verbose:D,B},this.onProgress=function(){for(var a=0;a<arguments.length;a++)arguments[a]&&"function"==typeof arguments[a]&&J.push(arguments[a]);return B},this.onComplete=function(){for(var a=0;a<arguments.length;a++)arguments[a]&&"function"==typeof arguments[a]&&K.push(arguments[a]);return B},this}