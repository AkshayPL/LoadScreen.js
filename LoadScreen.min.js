function LoadScreen(a,b){"use strict";function c(){I=requestAnimationFrame(c);for(k in F){var a=F[k],b=(a.targetValue-a.initialValue)/E/60;a.value=a.targetValue>=a.initialValue?Math.min(a.targetValue,a.value+b):Math.max(a.targetValue,a.value+b),"function"==typeof a.onUpdate&&a.onUpdate(),a.value===a.targetValue&&("function"==typeof a.onComplete&&a.onComplete(),"progress"===k&&1===a.value&&(delete F.progress,cancelAnimationFrame(I)))}}function d(a){A&&console.timeEnd("Total load screen duration"),y.domElement.parentNode.removeChild(y.domElement),D=!0,a&&"function"==typeof a&&a()}function e(a,b){D||(y.domElement.style.marginTop="-"+b/devicePixelRatio+"px",y.domElement.style.height=b/devicePixelRatio+"px",y.domElement.style.width=a/devicePixelRatio+"px")}function f(){var a=y.resources;if(a.textures){M+=Object.keys(a.textures).length,S.textures={};for(var b in a.textures)S.textures[b]={},V[b]={prog:0,fileSize:a.textures[b].fileSize},Y+=a.textures[b].fileSize}if(a.geometries){M+=Object.keys(a.geometries).length,S.geometries={};for(var b in a.geometries)a.geometries[b].path&&a.geometries[b].fileSize&&(S.geometries[b]={},W[b]={prog:0,fileSize:a.geometries[b].fileSize},Z+=a.geometries[b].fileSize)}if(a.objects){S.objects={};for(var b in a.objects)a.objects[b].path&&a.objects[b].fileSize&&(S.objects[b]={},X[b]={prog:0,fileSize:a.objects[b].fileSize},$+=a.objects[b].fileSize,M++)}if(a.textures)for(var b in a.textures)h(b);if(a.geometries)for(var b in a.geometries)a.geometries[b].path&&a.geometries[b].fileSize&&g(b);if(a.objects)for(var b in a.objects)a.objects[b].path&&a.objects[b].fileSize&&i(b)}function g(a){var b=y.resources.geometries[a],c=b.path.split("."),d=c[c.length-1];n(d).load(b.path,function(b){b.name=a,S.geometries[a]=b,W[a].prog=1,K++,u({type:"Geometry",name:a,progress:1}),v(!0)},function(b){var c=b.loaded/b.total;W[a].prog=c,1!==c&&u({type:"Geometry",name:a,progress:c}),v()})}function h(a){var b=y.resources.textures[a];l(b).load(b.path,function(c){for(var d in b)"undefined"!=typeof o[d]&&(c[d]=b[d]);c.name=a,S.textures[a]=c,V[a].prog=1,K++,u({type:"Texture",name:a,progress:1}),v(!0)},function(b){var c=b.loaded/b.total;V[a].prog=c,1!==c&&u({type:"Texture",name:a,progress:c}),v()})}function i(a){var b=y.resources.objects[a],c=b.path.split("."),d=c.length,e="assimp"===c[d-2]?"assimp.json":c[d-1];j(e).load(b.path,function(c,d){var f="assimp"===e?d.object:c;for(var g in b)"undefined"!=typeof f[g]&&(f[g]=b[g]);f.name=a,S.objects[a]=f,X[a].prog=1,K++,u({type:"Object",name:a,progress:1}),v(!0)},function(b){var c=b.loaded/b.total;X[a].prog=c,1!==c&&u({type:"Object",name:a,progress:c}),v()})}function j(a){switch(a){case"3mf":return R.threemf||(R.threemf=new THREE.ThreeMFLoader),R.threemf;case"amf":return R.amf||(R.amf=new THREE.AMFLoader),R.amf;case"assimp":return R.assimp||(R.assimp=new THREE.AssimpLoader),R.assimp;case"wrl":case"wrz":case"vrml":return R.vrml||(R.vrml=new THREE.VRMLLoader),R.vrml}}function l(a){return a.tryPVR&&m("pvr")?(Q.pvr=Q.pvr||new THREE.PVRLoader,Q.pvr):a.tryKTX&&m("ktx")?(Q.ktx=Q.ktx||new THREE.KTXLoader,Q.ktx):(Q.main=Q.main||new THREE.TextureLoader,Q.main)}function m(b){return"undefined"==typeof U[b]&&(T=T||a.context.getSupportedExtensions(),"pvr"===b?U[b]=T.indexOf("WEBGL_compressed_texture_pvrtc")>-1||T.indexOf("WEBKIT_WEBGL_compressed_texture_pvrtc")>-1:U[b]=T.indexOf("WEBGL_compressed_texture_etc1")>-1),U[b]}function n(a){switch(a){case"json":return P.json=P.json||new THREE.JSONLoader,P.json;case"ply":return P.ply=P.ply||new THREE.PLYLoader,P.ply;case"stl":return P.stl=P.stl||new THREE.STLLoader,P.stl;case"ctm":return P.ctm=P.ctm||new THREE.CTMLoader,P.ctm;case"vtk":return P.vtk=P.vtk||new THREE.VTKLoader,P.vtk}}function p(){A&&console.time("Processing duration");var a=y.resources.textures,b=S.textures;if(a)for(var c in b){for(var d in a[c])"path"!==d&&"fileSize"!==d&&(b[c][d]=a[c][d]);a[c]=b[c],delete b[c]}var e=y.resources.geometries,f=S.geometries;if(e)for(var c in f)e[c].toBufferGeometry&&"BufferGeometry"!==f[c].type&&(f[c]=(new THREE.BufferGeometry).fromGeometry(f[c])),e[c].onComplete&&ga[c].onComplete(f[c]),e[c]=f[c],delete f[c];var g=y.resources.objects,h=S.objects;if(g){var i=function(b,c){for(var d in g[b])"type"!==d&&"undefined"!=typeof c[d]&&(d.indexOf("map")>-1||d.indexOf("Map")>-1?c[d]=a[g[b][d]]:c[d]=g[b][d],delete g[b][d])},j=function(a,b,c){var d;switch(g[a].type){case"mesh":d=new THREE.Mesh(l,m);break;case"points":d=new THREE.Points(l,m);break;case"line":d=new THREE.Line(l,m);break;default:d=new THREE.Mesh(l,m)}return delete g[a].type,d},k=function(a,b){for(var c in g[a])"undefined"!=typeof b[c]?b[c]=g[a][c]:b.userData[c]=g[a][c],delete g[a]};for(var c in g)if(g[c].path&&g[c].fileSize)i(c,h[c].material),k(c,h[c]),g[c].onComplete&&g[c].onComplete(h[c]),g[c]=h[c];else if("string"==typeof g[c].geometry){var l=y.resources.geometries[g[c].geometry],m=g[c].material;delete g[c].geometry,delete g[c].material,i(c,m);var n=j(c,l,m);k(c,n),g[c].onComplete&&g[c].onComplete(n),g[c]=n}else if(!g[c]instanceof THREE.Object3D){var l=g[c].geometry,m=g[c].material;delete g[c].geometry,delete g[c].material,i(c,g[c].material);var n=j(c,l,m);k(c,n),g[c].onComplete&&g[c].onComplete(n),g[c]=n}}A&&console.timeEnd("Processing duration")}function q(){var c=document.createElement("div"),d=document.createElement("div");c.style.cssText="background: "+b.background+";position: relative;overflow: hidden;";var e=b.size.indexOf("%")>-1?"%":"px",f=parseInt(b.size)/2+e;d.style.cssText="width: "+b.size+";top: 50%; left: 50%;margin-left: -"+f+";text-align: center;position: relative;display: inline-block",y.domElement=c,y.infoContainer=d,y.setSize(a.domElement.width,a.domElement.height),a.domElement.parentNode.appendChild(c)}function r(){switch(b.textInfo&&(N=document.createElement("p"),N.textContent="string"==typeof b.textInfo?b.textInfo:b.textInfo[0],N.style.cssText="color: "+b.infoColor+";display: inline-block;font-family: monospace;font-size: 12px"),b.sizeInfo&&(O=document.createElement("p"),O.textContent="0.00MB",O.style.cssText="color: "+b.infoColor+";font-family: monospace;font-size: 12px;display: inline-block;"),b.type){case"bar":s();break;case"circular":t();break;default:s()}}function s(){var a=document.createElement("div"),c=document.createElement("div");a.style.cssText="background: "+b.progressBarContainer+";border: solid 1px "+b.progressBarContainer+";width: 100%; height: "+b.weight+";box-sizing: border-box;position: relative;",c.style.cssText="background: "+b.progressBar+";width: 0%; height: 100%;top: 0; left: 0;position: absolute;",a.appendChild(c),b.textInfo&&y.infoContainer.appendChild(N),y.infoContainer.appendChild(a),b.sizeInfo&&y.infoContainer.appendChild(O);var d=function(){c.style.width=(100*F.progress.value).toString()+"%",b.sizeInfo&&(O.textContent=(F.progress.value*(Y+Z)/1024).toFixed(2)+" MB")};F.progress={key:"progress",duration:E,targetValue:C,initialValue:0,value:0,onUpdate:d},G.push(function(){F.progress.initialValue=F.progress.value,F.progress.targetValue=C,F.progress.duration+=E})}function t(){var a="<svg style='width: 100%; height: 100%;' width=200 height=200 viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>\t<circle fill="+b.progressBarContainer+" cx='0' cy='0' transform='translate(100,100)'  r='"+(80+parseInt(b.weight)/2+2).toString()+"'/>\t<circle fill="+b.background+" cx='0' cy='0' transform='translate(100,100)'  r='"+(80-parseInt(b.weight)/2-2).toString()+"'/>\t<circle fill='none' cx='0' cy='0' transform='translate(100,100) rotate(-90)' r='80' stroke-dashoffset='1503'/></svg>";y.infoContainer.innerHTML=a;var c=y.infoContainer.firstElementChild.lastElementChild;if(c.style.cssText="stroke:"+b.progressBar+";stroke-width:"+parseInt(b.weight)+";stroke-dasharray:502;",b.textInfo||b.sizeInfo){var d=document.createElement("div");d.style.cssText="width: 100%; left: 50%; top: 50%;margin-left: -50%;position: absolute;",y.infoContainer.appendChild(d),b.textInfo&&d.appendChild(N),b.sizeInfo&&d.appendChild(O),N.style.display=O.style.display="block"}var e=function(){c.setAttribute("stroke-dashoffset",(502*(1-F.progress.value)).toString()),b.sizeInfo&&(O.textContent=(F.progress.value*(Y+Z)/1024).toFixed(2)+" MB")};F.progress={key:"progress",duration:E,targetValue:C,initialValue:0,value:0,onUpdate:e},G.push(function(){F.progress.initialValue=F.progress.value,F.progress.targetValue=C,F.progress.duration+=E})}function u(a){var b=0,c=0;for(var d in V)b+=V[d].prog*V[d].fileSize;for(var d in W)c+=W[d].prog*W[d].fileSize;C=(b+c)/(Y+Z),"undefined"!=typeof a&&A&&console.info("Progress = "+C+", "+a.type+" > "+a.name+" > "+Math.round(100*a.progress)+"%"),v()}function v(a){for(var c=0;c<G.length;c++)G[c](C);if(1===C&&a){A&&console.timeEnd("Loading duration");var d=function(){y.resources?"custom"!==b.type&&b.textInfo?(N.textContent="string"==typeof b.textInfo?b.textInfo:b.textInfo[1],setTimeout(function(){p(),N.textContent="string"==typeof b.textInfo?b.textInfo:b.textInfo[2],setTimeout(w,20)},20)):(p(),w()):x()};"custom"!==b.type?F.progress.onComplete=function(){1===F.progress.value&&d()}:d()}}function w(){var b=new THREE.Scene,c=new THREE.OrthographicCamera((-1),1,1,(-1),0,2),d=new THREE.WebGLRenderTarget(10,10,{generateMipmaps:!0});for(var e in y.resources.objects)b.add(y.resources.objects[e]);A&&console.time("Compiling duration"),a.render(b,c,d);for(var e in y.resources.objects)b.remove(y.resources.objects[e]);A&&console.timeEnd("Compiling duration"),d.dispose(),x()}function x(){for(var a=0;a<H.length;a++)H[a]()}var y=this,z=null,A=!1,B=!1,C=0,D=!1,E=.5,F={},G=[],H=[],I,J,K=0,L=0,M=0,N,O,P={},Q={},R={},S={},T,U={},V={},W={},X={},Y=0,Z=0,$=0;return this.domElement=null,this.infoContainer=null,this.resources=null,this.setSize=e,b=b||{},b={type:"undefined"!=typeof b.type?b.type:"bar",size:b.size?b.size:"150px",background:b.background?b.background:"#333",progressBarContainer:b.progressBarContainer?b.progressBarContainer:"#444",progressBar:b.progressBar?b.progressBar:"#fb0",weight:b.weight?b.weight:"6px",infoColor:b.infoColor?b.infoColor:"#666",sizeInfo:"undefined"==typeof b.sizeInfo||b.sizeInfo,textInfo:"undefined"!=typeof b.textInfo?b.textInfo:["Loading","Processing","Compiling"]},q(),"custom"!==b.type&&r(),this.start=function(a){if("custom"!==b){y.domElement.appendChild(y.infoContainer);var d=-parseInt(getComputedStyle(y.infoContainer,null).height)/2;if(y.infoContainer.style.marginTop=d+"px","circular"===b.type){var e=-parseInt(getComputedStyle(y.infoContainer.lastElementChild,null).height)/2;y.infoContainer.lastElementChild.style.marginTop=e+"px"}c()}return A&&console.time("Total load screen duration"),a&&(A&&console.time("Loading duration"),y.resources=a,f()),y},this.remove=function(a){"custom"!==b.type?(c(),F.disappear={key:"opacity",duration:E,targetValue:0,initialValue:1,value:1,onUpdate:function(){y.infoContainer.style.opacity=F.disappear.value},onComplete:function(){cancelAnimationFrame(I),d(a)}}):d(a)},this.setProgress=function(a){C=a,v(!0)},this.setOptions=function(a){return E="undefined"!=typeof a.tweenDuration?a.tweenDuration:E,B="undefined"!=typeof a.forcedStart?a.forcedStart:B,A="undefined"!=typeof a.verbose?a.verbose:A,y},this.onProgress=function(){for(var a=0;a<arguments.length;a++)arguments[a]&&"function"==typeof arguments[a]&&G.push(arguments[a]);return y},this.onComplete=function(){for(var a=0;a<arguments.length;a++)arguments[a]&&"function"==typeof arguments[a]&&H.push(arguments[a]);return y},this}