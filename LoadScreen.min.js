function LoadScreen(a,b){"use strict";function c(a){s&&console.timeEnd("Total load screen duration"),q.domElement.parentNode.removeChild(q.domElement),v=!0,a&&"function"==typeof a&&a()}function d(a,b){v||(q.domElement.style.marginTop="-"+b/devicePixelRatio+"px",q.domElement.style.height=b/devicePixelRatio+"px",q.domElement.style.width=a/devicePixelRatio+"px")}function e(){var a=q.resources;if(a.textures){E+=Object.keys(a.textures).length,output.textures={};for(var b in a.textures)output.textures[b]={},K[b]={prog:0,fileSize:a.textures[b].fileSize},M+=a.textures[b].fileSize}if(a.geometries){E+=Object.keys(a.geometries).length,output.geometries={};for(var b in a.geometries)output.geometries[b]={},L[b]={prog:0,fileSize:a.geometries[b].fileSize},N+=a.geometries[b].fileSize}if(a.geometries)for(var b in a.geometries)f(b);if(a.textures)for(var b in a.textures)g(b)}function f(a){var b=q.resources.geometries[a];b.path.indexOf(".json")>-1&&(H.json||(H.json=new THREE.JSONLoader),H.json.load(b.path,function(b){b.name=a,output.geometries[a]=b,L[a].prog=1,C++,m({geometry:!0,name:a,progress:1}),n(!0)},function(b){var c=b.loaded/b.total;L[a].prog=c,1!==c&&m({geometry:!0,name:a,progress:c}),n()}))}function g(a){var b=q.resources.textures[a];I||(I=new THREE.TextureLoader),I.load(b.path,function(c){for(var d in b)"fileSize"!==d&&"path"!==d&&"undefined"!=typeof c[d]&&(c[d]=b[d]);c.name=a,output.textures[a]=c,K[a].prog=1,C++,m({texture:!0,name:a,progress:1}),n(!0)},function(b){var c=b.loaded/b.total;K[a].prog=c,1!==c&&m({texture:!0,name:a,progress:c}),n()})}function h(){s&&console.time("Processing duration");var a=q.resources.textures,b=output.textures;if(a)for(var c in b){for(var d in a[c])"path"!==d&&"fileSize"!==d&&(b[c][d]=a[c][d]);a[c]=b[c],delete b[c]}var e=q.resources.geometries,f=output.geometries;if(e)for(var c in f)e[c].toBufferGeometry&&"BufferGeometry"!==f[c].type&&(f[c]=(new THREE.BufferGeometry).fromGeometry(f[c])),e[c].copyUv1ToUv2&&"BufferGeometry"===f[c].type&&f[c].addAttribute("uv2",f[c].attributes.uv),e[c].computeNormals&&f[c].computeVertexNormals(),e[c].computeFlatNormals&&f[c].computeFlatVertexNormals(),e[c]=f[c],delete f[c];var g=q.resources.objects;if(g)for(var c in g){var h=q.resources.geometries[g[c].geometry],i=g[c].material;delete g[c].geometry,delete g[c].material;for(var d in g[c])"type"!==d&&"undefined"!=typeof i[d]&&(d.indexOf("map")>-1||d.indexOf("Map")>-1?i[d]=a[g[c][d]]:i[d]=g[c][d],delete g[c][d]);var j;switch(g[c].type){case"mesh":j=new THREE.Mesh(h,i);break;case"points":j=new THREE.Points(h,i);break;case"line":j=new THREE.Line(h,i);break;default:j=new THREE.Mesh(h,i)}delete g[c].type;for(var d in g[c])"undefined"!=typeof j[d]?j[d]=g[c][d]:j.userData[d]=g[c][d],delete g[c];g[c]=j}s&&console.timeEnd("Processing duration")}function i(){var c=document.createElement("div"),d=document.createElement("div");c.style.cssText="background: "+b.background+";position: relative;overflow: hidden;";var e=b.size.indexOf("%")>-1?"%":"px",f=parseInt(b.size)/2+e;d.style.cssText="width: "+b.size+";top: 50%; left: 50%;margin-left: -"+f+";text-align: center;position: relative;display: inline-block",q.domElement=c,q.infoContainer=d,q.setSize(a.domElement.width,a.domElement.height),a.domElement.parentNode.appendChild(c)}function j(){switch(b.textInfo&&(F=document.createElement("p"),F.textContent="string"==typeof b.textInfo?b.textInfo:b.textInfo[0],F.style.cssText="color: "+b.infoColor+";display: inline-block;font-family: monospace;font-size: 12px"),b.sizeInfo&&(G=document.createElement("p"),G.textContent="0.00MB",G.style.cssText="color: "+b.infoColor+";font-family: monospace;font-size: 12px;display: inline-block;"),b.type){case"bar":k();break;case"circle":l();break;default:k()}}function k(){var a=document.createElement("div"),c=document.createElement("div");a.style.cssText="background: "+b.progressBarContainer+";border: solid 1px "+b.progressBarContainer+";width: 100%; height: 6px;box-sizing: border-box;position: relative;",c.style.cssText="background: "+b.progressBar+";width: 0%; height: 100%;top: 0; left: 0;position: absolute;",a.appendChild(c),b.textInfo&&q.infoContainer.appendChild(F),q.infoContainer.appendChild(a),b.sizeInfo&&q.infoContainer.appendChild(G);var d=function(){c.style.width=(100*x.progress).toString()+"%",b.sizeInfo&&(G.textContent=(x.progress*(M+N)/1024).toFixed(2)+" MB")};y.push(function(){TweenLite.to(x,w,{progress:u,onUpdate:d})})}function l(){}function m(a){var b=0,c=0;for(var d in K)b+=K[d].prog*K[d].fileSize;for(var d in L)c+=L[d].prog*L[d].fileSize;if(u=(b+c)/(M+N),"undefined"!=typeof a&&s){var e=a.texture?"Texture":a.geometry?"Geometry":"Unknown asset type";console.info("Progress = "+u+", "+e+" > "+a.name+" > "+Math.round(100*a.progress)+"%")}n()}function n(a){for(var c=0;c<y.length;c++)y[c](u);if(1===u&&a){s&&console.timeEnd("Loading duration");var d=function(){b.textInfo?q.resources&&(F.textContent="string"==typeof b.textInfo?b.textInfo:b.textInfo[1],setTimeout(function(){h(),o()},20)):(q.resources&&h(),o())};"custom"!==b.type?setTimeout(d,1e3*w):d()}}function o(){z.length?(F.textContent="string"==typeof b.textInfo?b.textInfo:b.textInfo[2],setTimeout(function(){console.time("Compiling duration");for(var a=0;a<A.length;a++)z[a]();console.timeEnd("Compiling duration"),p()},20)):p()}function p(){for(var a=0;a<A.length;a++)A[a]()}var q=this,r=null,s=!1,t=!1,u=0,v=!1,w=1,x={progress:0},y=[],z=[],A=[],B,C=0,D=0,E=0,F,G,H={},I,J={},K={},L={},M=0,N=0;return this.domElement=null,this.infoContainer=null,this.resources=null,this.setSize=d,b=b||{},b={type:"undefined"!=typeof b.type?b.type:"bar",size:b.size?b.size:"100px",background:b.background?b.background:"#ddd",progressBarContainer:b.progressBarContainer?b.progressBarContainer:"#bbb",progressBar:b.progressBar?b.progressBar:"#666",infoColor:b.infoColor?b.infoColor:"#666",percentInfo:"undefined"==typeof b.percentInfo||b.percentInfo,sizeInfo:"undefined"==typeof b.sizeInfo||b.sizeInfo,textInfo:"undefined"!=typeof b.textInfo?b.textInfo:["Loading","Processing","Compiling"]},i(),"custom"!==b.type&&j(),this.start=function(a){if(b!==!1){q.domElement.appendChild(q.infoContainer);var c=-parseInt(getComputedStyle(q.infoContainer,null).height)/2;q.infoContainer.style.marginTop=c+"px"}return s&&console.time("Total load screen duration"),a&&(s&&console.time("Loading duration"),q.resources=a,e()),q},this.compile=function(){for(var a=0;a<arguments.length;a++)arguments[a]&&"function"==typeof arguments[a]&&z.push(arguments[a]);return q},this.remove=function(a){if("custom"!==b.type){var d={opacity:1};TweenLite.to(d,w,{opacity:0,onUpdate:function(){q.infoContainer.style.opacity=d.opacity},onComplete:function(){c(a)}})}else c()},this.setProgress=function(a){u=a,n(!0)},this.setOptions=function(a){return w="undefined"!=typeof a.tweenDuration?a.tweenDuration:w,t="undefined"!=typeof a.forcedStart?a.forcedStart:t,s="undefined"!=typeof a.verbose?a.verbose:s,q},this.onProgress=function(){for(var a=0;a<arguments.length;a++)arguments[a]&&"function"==typeof arguments[a]&&y.push(arguments[a]);return q},this.onComplete=function(){for(var a=0;a<arguments.length;a++)arguments[a]&&"function"==typeof arguments[a]&&A.push(arguments[a]);return q},this}